module stratego/rtg/parse

imports
  org.strategoxt.imp.debuggers.stratego.runtime


imports
  libstratego-sglr


strategies
  parse-rtg-file =
    s-enter(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "parse-rtg-file", "12,2,15,17")
    ; s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "13,4,15,17")
    ; (s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "13,4,13,38")
       ; where(s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "13,10,13,37")
               ; tbl := <s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "13,18,13,36") ; get-rtg-parse-table>))
    ; s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "14,6,15,17")
    ; (s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "14,6,14,83")
       ; parse-file(
           s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "14,17,14,30") ; strsglr-perror
         , s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "14,33,14,58") ; strsglr-report-parse-error
         | <s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "14,63,14,81") ; get-rtg-parse-table>
         ))
    ; s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "15,6,15,17")
    ; rtg-parsefix
    < s-exit(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "parse-rtg-file", "12,2,15,17")
    + s-exit(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "parse-rtg-file", "12,2,15,17")
      ; fail

  parse-rtg-stream =
    s-enter(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "parse-rtg-stream", "17,2,20,17")
    ; s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "18,4,20,17")
    ; (s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "18,4,18,38")
       ; where(s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "18,10,18,37")
               ; tbl := <s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "18,18,18,36") ; get-rtg-parse-table>))
    ; s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "19,6,20,17")
    ; (s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "19,6,19,69")
       ; parse-stream(
           s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "19,19,19,44") ; strsglr-report-parse-error
         | <s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "19,49,19,67") ; get-rtg-parse-table>
         ))
    ; s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "20,6,20,17")
    ; rtg-parsefix
    < s-exit(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "parse-rtg-stream", "17,2,20,17")
    + s-exit(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "parse-rtg-stream", "17,2,20,17")
      ; fail

  get-rtg-parse-table =
    s-enter(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "get-rtg-parse-table", "22,2,27,42")
    ; s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "23,4,27,42")
    ; (s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "23,4,23,20") ; MemoRTGParseTable
       <+ s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "24,7,27,42")
          ; (s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "24,7,24,26") ; import-term(rtg.tbl))
          ; s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "25,9,27,42")
          ; (s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "25,9,25,24") ; open-parse-table)
          ; s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "26,9,27,42")
          ; (s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "26,9,26,12") ; ?tbl)
          ; s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "27,9,27,42")
          ; rules ( MemoRTGParseTable :
                      _ -> tbl ))
    < s-exit(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "get-rtg-parse-table", "22,2,27,42")
    + s-exit(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "get-rtg-parse-table", "22,2,27,42")
      ; fail

  external STRRTG-get-rtg-parsetable(|)


strategies
  rtg-parsefix =
    s-enter(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "rtg-parsefix", "36,2,37,29")
    ; s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "37,4,37,29")
    ; topdown(
        s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "37,12,37,28")
        ; try(
            s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "37,16,37,27") ; rtg-ParseFix
          )
      )
    < s-exit(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "rtg-parsefix", "36,2,37,29")
    + s-exit(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "rtg-parsefix", "36,2,37,29")
      ; fail

  rtg-ParseFix :
    Plain(s) -> <r-exit(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "rtg-ParseFix", "39,2,40,16")> s
    where r-enter(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "rtg-ParseFix", "39,2,40,16")
          <+ r-exit(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "rtg-ParseFix", "39,2,40,16")
             ; fail

  rtg-ParseFix :
    Quoted(parts) -> <r-exit(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "rtg-ParseFix", "42,2,46,12")> <s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "44,8,45,21")
                                                                                                                              ; (s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "44,8,44,64")
                                                                                                                                 ; map(
                                                                                                                                     s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "44,12,44,63")
                                                                                                                                     ; (s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "44,12,44,23")
                                                                                                                                        ; ?Chars(
                                                                                                                                             <s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "44,20,44,21") ; id>
                                                                                                                                           )
                                                                                                                                        + s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "44,27,44,63")
                                                                                                                                          ; ?EscapeSeq(
                                                                                                                                               <s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "44,39,44,61")
                                                                                                                                                ; <(s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "44,40,44,53") ; implode-string)> [<s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "44,58,44,59") ; id>]>
                                                                                                                                             ))
                                                                                                                                   ))
                                                                                                                              ; s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "45,8,45,21")
                                                                                                                              ; concat-strings> parts
    where r-enter(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "rtg-ParseFix", "42,2,46,12")
          <+ r-exit(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "rtg-ParseFix", "42,2,46,12")
             ; fail

  rtg-ParseFix =
    s-enter(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "rtg-ParseFix", "48,2,49,27")
    ; s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "49,4,49,27")
    ; TupleTerm(
        s-step(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "49,14,49,26") ; string-to-int
      )
    < s-exit(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "rtg-ParseFix", "48,2,49,27")
    + s-exit(|"strategoxt/stratego-libraries/rtg/lib/stratego/rtg/parse.str", "rtg-ParseFix", "48,2,49,27")
      ; fail