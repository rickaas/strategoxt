module cgen-aterm

imports
  org.strategoxt.imp.debuggers.stratego.runtime


imports
  libstratego-lib


signature
  constructors
    FunctionName : ConfigKey


strategies
  main-cgen-aterm =
    s-enter(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "main-cgen-aterm", "16,2,27,6")
    ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "17,4,27,6")
    ; input-wrap(
        s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "17,15,17,33") ; functionname-option
      , s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "18,6,26,32")
        ; (s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "18,6,18,36")
           ; tbl := <s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "18,14,18,35") ; write-to-shared-string>)
        ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "19,8,26,32")
        ; (s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "19,8,19,32")
           ; where(s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "19,14,19,31")
                   ; print-header(|tbl)))
        ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "20,8,26,32")
        ; (s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "20,8,25,8")
           ; repeat(
               s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "21,10,24,31")
               ; (s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "21,10,23,12")
                  ; (s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "21,10,21,32")
                     ; splitmap(
                         s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "21,19,21,28") ; print-elem
                       | 15
                       ))
                  ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "22,10,23,12")
                  ; (s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "22,10,22,22") ; print-newline)
                  ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "23,10,23,12")
                  ; Snd
                  <+ s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "24,11,24,31")
                     ; (s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "24,11,24,25")
                        ; map(
                            s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "24,15,24,24") ; print-elem
                          ))
                     ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "24,28,24,31")
                     ; fail)
             ))
        ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "26,8,26,32")
        ; where(s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "26,14,26,31")
                ; print-footer(|tbl))
      )
    < s-exit(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "main-cgen-aterm", "16,2,27,6")
    + s-exit(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "main-cgen-aterm", "16,2,27,6")
      ; fail

  functionname-option =
    s-enter(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "functionname-option", "29,2,38,6")
    ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "30,6,38,6")
    ; (s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "30,6,33,6")
       ; ArgOption(
           s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "30,16,30,23") ; "--name"
         , s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "31,8,31,57")
           ; OptionHandler(
               s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "31,22,31,56")
               ; <(s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "31,23,31,32") ; set-config)> ( FunctionName()
                                                                                                                     , <s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "31,53,31,54") ; id>
                                                                                                                     )
             )
         | "--name           Function name for getting the ATerm"
         )
       + s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "35,6,38,6")
         ; OptionCheck(
             s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "35,18,35,44")
             ; <(s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "35,19,35,28") ; set-config)> ("--help", ())
           , s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "36,8,36,31")
             ; OptionOneCheck(
                 s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "36,23,36,30") ; "--name"
               )
           | "error: option --name is required"
           ))
    < s-exit(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "functionname-option", "29,2,38,6")
    + s-exit(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "functionname-option", "29,2,38,6")
      ; fail


strategies
  print-header(|tbl) =
    s-enter(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "print-header", "42,2,51,4")
    ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "43,4,51,4")
    ; where(s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "44,6,50,23")
            ; <(s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "44,7,44,17") ; fputstrings)> ( [ "
#include <aterm1.h>

ATerm "
                                                                                                                    , <s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "47,10,47,19") ; get-config> FunctionName()
                                                                                                                    , "_0_0(ATerm t) {
  static ATerm result = NULL;
  static char parsetable[] = {
    "
                                                                                                                    ]
                                                                                                                  , <s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "50,9,50,21") ; stdout-stream>
                                                                                                                  ))
    < s-exit(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "print-header", "42,2,51,4")
    + s-exit(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "print-header", "42,2,51,4")
      ; fail

  print-footer(|tbl) =
    s-enter(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "print-footer", "53,2,66,4")
    ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "54,4,66,4")
    ; where(s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "54,10,65,19")
            ; <(s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "54,11,54,21") ; fputstrings)> ( [ "
  0 };

  if(result == NULL) {
      result = ATreadFromSharedString(parsetable, "
                                                                                                                     , <s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "58,54,58,74")
                                                                                                                        ; (s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "58,54,58,59") ; length)
                                                                                                                        ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "58,62,58,74")
                                                                                                                        ; int-to-string> tbl
                                                                                                                     , ");
    if(result != NULL) {
      ATprotect(&result);
    }
  }
  return result;
}
"
                                                                                                                     ]
                                                                                                                   , <s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "65,5,65,17") ; stdout-stream>
                                                                                                                   ))
    < s-exit(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "print-footer", "53,2,66,4")
    + s-exit(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "print-footer", "53,2,66,4")
      ; fail

  print-newline =
    s-enter(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "print-newline", "68,2,69,41")
    ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "69,4,69,41")
    ; where(s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "69,10,69,40")
            ; <(s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "69,11,69,15") ; fputs)> ( "\n"
                                                                                                             , <s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "69,26,69,38") ; stdout-stream>
                                                                                                             ))
    < s-exit(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "print-newline", "68,2,69,41")
    + s-exit(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "print-newline", "68,2,69,41")
      ; fail

  print-elem =
    s-enter(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "print-elem", "71,2,73,35")
    ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "72,4,73,35")
    ; (s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "72,4,72,45")
       ; <(s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "72,5,72,9") ; fputs)> ( <s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "72,14,72,26") ; int-to-string>
                                                                                                      , <s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "72,31,72,43") ; stdout-stream>
                                                                                                      ))
    ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "73,6,73,35")
    ; <(s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "73,7,73,11") ; fputs)> ( ","
                                                                                                    , <s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "73,21,73,33") ; stdout-stream>
                                                                                                    )
    < s-exit(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "print-elem", "71,2,73,35")
    + s-exit(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "print-elem", "71,2,73,35")
      ; fail

  fputstrings =
    s-enter(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "fputstrings", "75,2,77,42")
    ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "76,4,77,42")
    ; (s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "76,4,76,21")
       ; ?(strings, stream))
    ; s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "77,6,77,42")
    ; <(s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "77,7,77,33")
        ; map(
            s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "77,11,77,32")
            ; <(s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "77,12,77,16") ; fputs)> ( <s-step(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "77,21,77,22") ; id>
                                                                                                             , stream
                                                                                                             )
          ))> strings
    < s-exit(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "fputstrings", "75,2,77,42")
    + s-exit(|"strategoxt/stratego-libraries/build-tools/cgen-aterm.str", "fputstrings", "75,2,77,42")
      ; fail