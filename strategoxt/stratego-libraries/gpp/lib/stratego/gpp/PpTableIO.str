module stratego/gpp/PpTableIO

imports
  org.strategoxt.imp.debuggers.stratego.runtime


imports
  pp-table
  libstratego-sglr


strategies
  pptable-make-hashtable =
    s-enter(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-make-hashtable", "18,2,25,9")
    ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "19,4,25,9")
    ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "19,4,19,32")
       ; where(s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "19,10,19,31")
               ; tbl := <s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "19,18,19,30") ; new-hashtable>))
    ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "20,6,25,9")
    ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "20,6,24,6")
       ; map(
           s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "21,8,23,62")
           ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "21,8,21,22")
              ; ?PP-Table(
                   <s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "21,19,21,20") ; id>
                 ))
           ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "22,10,23,62")
           ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "22,10,22,16") ; reverse)
           ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "23,10,23,62")
           ; map(
               s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "23,14,23,61")
               ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "23,14,23,34") ; pptable-desugar-entry)
               ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "23,37,23,61")
               ; pptable-store-entry(|tbl)
             )
         ))
    ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "25,6,25,9")
    ; !tbl
    < s-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-make-hashtable", "18,2,25,9")
    + s-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-make-hashtable", "18,2,25,9")
      ; fail

  pptable-store-entry(|tbl) =
    s-enter(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-store-entry", "27,2,29,67")
    ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "28,5,29,67")
    ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "28,5,28,32")
       ; ?entry@PP-Entry(path, value))
    ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "29,7,29,67")
    ; <(s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "29,8,29,62")
        ; hashtable-put(
          | <s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "29,24,29,39") ; pptable-make-key> entry
          , (path, value)
          ))> tbl
    < s-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-store-entry", "27,2,29,67")
    + s-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-store-entry", "27,2,29,67")
      ; fail


strategies
  pptable-path-to-string =
    s-enter(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-path-to-string", "39,2,40,15")
    ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "40,4,40,15")
    ; ?Path1(
         <s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "40,12,40,13") ; id>
       )
    < s-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-path-to-string", "39,2,40,15")
    + s-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-path-to-string", "39,2,40,15")
      ; fail

  pptable-path-to-string =
    s-enter(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-path-to-string", "45,2,50,31")
    ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "46,4,50,31")
    ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "46,4,46,18")
       ; ?Path(s1, s2))
    ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "47,6,50,31")
    ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "47,6,49,15")
       ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "47,6,49,9")
          ; <(s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "47,8,48,13")
              ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "47,8,47,65")
                 ; map(
                     s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "47,13,47,63")
                     ; \ selector(a, b) -> [ "."
                                           , <s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "47,39,47,51") ; int-to-string> a
                                           , ":"
                                           , b
                                           ] \
                   ))
              ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "48,8,48,13")
              ; concat)> s2) => s3)
    ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "50,6,50,31")
    ; <(s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "50,7,50,20") ; concat-strings)> [s1|s3]
    < s-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-path-to-string", "45,2,50,31")
    + s-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-path-to-string", "45,2,50,31")
      ; fail


strategies
  pptable-make-key :
    PP-Entry(Path1(s), value) -> <r-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-make-key", "60,2,63,47")> (arity, [s])
    where r-enter(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-make-key", "60,2,63,47")
          <+ r-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-make-key", "60,2,63,47")
             ; fail
    where s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "63,6,63,47")
          ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "63,6,63,38")
             ; <(s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "63,7,63,31") ; pptable-arity-of-template)> value) => arity
          <+ r-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-make-key", "60,2,63,47")
             ; fail

  pptable-make-key :
    PP-Entry(Path(s1, s2), value) -> <r-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-make-key", "65,2,68,40")> <s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "66,38,66,44") ; reverse> [s1|xs]
    where r-enter(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-make-key", "65,2,68,40")
          <+ r-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-make-key", "65,2,68,40")
             ; fail
    where s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "68,6,68,40")
          ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "68,6,68,33")
             ; <(s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "68,7,68,29")
                 ; map(
                     s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "68,11,68,28")
                     ; ?selector(
                          <s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "68,22,68,23") ; id>
                        , _
                        )
                   ))> s2) => xs
          <+ r-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-make-key", "65,2,68,40")
             ; fail

  pptable-arity-of-template =
    s-enter(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-arity-of-template", "75,2,76,27")
    ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "76,4,76,27")
    ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "76,4,76,19")
       ; collect(
           s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "76,12,76,18")
           ; Arg(
               s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "76,16,76,17") ; id
             )
         ))
    ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "76,22,76,27")
    ; length
    < s-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-arity-of-template", "75,2,76,27")
    + s-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-arity-of-template", "75,2,76,27")
      ; fail


strategies
  pptable-desugar-entry =
    s-enter(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-desugar-entry", "83,2,91,4")
    ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "84,4,91,4")
    ; topdown(
        s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "85,6,90,6")
        ; try(
            s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "86,8,89,34")
            ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "86,8,86,25")
               ; Arg(
                   s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "86,12,86,24") ; string-to-int
                 )
               + s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "87,8,89,34")
                 ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "87,8,87,41")
                    ; Arg2(
                        s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "87,13,87,25") ; string-to-int
                      , s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "87,28,87,40") ; string-to-int
                      )
                    + s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "88,8,89,34")
                      ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "88,8,88,35")
                         ; S(
                             s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "88,10,88,34")
                             ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "88,10,88,24") ; un-double-quote)
                             ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "88,27,88,34")
                             ; unescape
                           )
                         + s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "89,8,89,34")
                           ; selector(
                               s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "89,17,89,29") ; string-to-int
                             , s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "89,32,89,33") ; id
                             ))))
          )
      )
    < s-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-desugar-entry", "83,2,91,4")
    + s-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-desugar-entry", "83,2,91,4")
      ; fail


strategies
  pptable-get-log(|tbl) =
    s-enter(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-get-log", "101,2,105,17")
    ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "102,4,105,17")
    ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "102,4,102,7") ; ?key)
    ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "103,8,105,16")
    ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "103,8,103,32")
       ; <(s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "103,9,103,27")
           ; hashtable-get(|key))> tbl
       <+ s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "104,11,105,16")
          ; (s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "104,11,104,89")
             ; log(
               | Error()
               , <s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "104,25,104,38") ; concat-strings> [ "No pp entry found for: "
                                                                                                                                 , <s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "104,68,104,82") ; write-to-string> key
                                                                                                                                 ]
               ))
          ; s-step(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "105,13,105,16")
          ; fail)
    < s-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-get-log", "101,2,105,17")
    + s-exit(|"strategoxt/stratego-libraries/gpp/lib/stratego/gpp/PpTableIO.str", "pptable-get-log", "101,2,105,17")
      ; fail