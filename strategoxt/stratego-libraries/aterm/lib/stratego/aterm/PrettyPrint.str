module stratego/aterm/PrettyPrint

imports
  org.strategoxt.imp.debuggers.stratego.runtime


imports
  libstratego-lib
  libstratego-gpp
  stratego/aterm/PrettyPrintRules


strategies
  pp-aterm-stream(|stream) =
    s-enter(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "pp-aterm-stream", "9,2,10,30")
    ; s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "10,4,10,30")
    ; pp-aterm-stream(|8, stream)
    < s-exit(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "pp-aterm-stream", "9,2,10,30")
    + s-exit(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "pp-aterm-stream", "9,2,10,30")
      ; fail

  pp-aterm-stream(|maxtermsize, stream) =
    s-enter(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "pp-aterm-stream", "12,2,16,27")
    ; s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "13,4,16,27")
    ; (s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "13,4,13,23") ; aterm-escape-strings)
    ; s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "14,6,16,27")
    ; (s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "14,6,14,31")
       ; pp-aterm-box(|maxtermsize))
    ; s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "15,6,16,27")
    ; (s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "15,6,15,33")
       ; box2text-stream(|80, stream))
    ; s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "16,6,16,27")
    ; <(s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "16,7,16,11") ; fputs)> ("\n", stream)
    < s-exit(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "pp-aterm-stream", "12,2,16,27")
    + s-exit(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "pp-aterm-stream", "12,2,16,27")
      ; fail


strategies
  aterm-escape-strings =
    s-enter(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "aterm-escape-strings", "27,2,28,36")
    ; s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "28,4,28,36")
    ; topdown(
        s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "28,12,28,35")
        ; try(
            s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "28,16,28,34") ; aterm-escape-string
          )
      )
    < s-exit(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "aterm-escape-strings", "27,2,28,36")
    + s-exit(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "aterm-escape-strings", "27,2,28,36")
      ; fail

  aterm-escape-string :
    s1{t*} -> <r-exit(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "aterm-escape-string", "30,2,43,10")> s2{t*}
    where r-enter(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "aterm-escape-string", "30,2,43,10")
          <+ r-exit(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "aterm-escape-string", "30,2,43,10")
             ; fail
    where s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "33,6,43,10")
          ; (s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "33,6,33,8") ; !s1)
          ; s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "34,8,43,10")
          ; (s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "34,8,42,8")
             ; string-as-chars(
                 s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "35,10,41,10")
                 ; escape-chars(
                     s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "36,12,40,33")
                     ; (s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "36,12,36,27") ; Escape-backslash
                        + s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "37,12,40,33")
                          ; (s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "37,12,37,30") ; Escape-double-quote
                             + s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "38,12,40,33")
                               ; (s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "38,12,38,26") ; Escape-linefeed
                                  + s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "39,12,40,33")
                                    ; (s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "39,12,39,48")
                                       ; \ ['\t'|cs] -> ['\', 't'|cs] \
                                       + s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "40,12,40,33") ; Escape-carriage-return))))
                   )
               ))
          ; s-step(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "43,8,43,10")
          ; ?s2
          <+ r-exit(|"strategoxt/stratego-libraries/aterm/lib/stratego/aterm/PrettyPrint.str", "aterm-escape-string", "30,2,43,10")
             ; fail