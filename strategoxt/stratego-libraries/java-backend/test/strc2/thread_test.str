module thread-test

imports
  org.strategoxt.imp.debuggers.stratego.runtime


imports
  libstratego-lib


signature
  constructors
    Ann : Int * a -> a
    F   : A * A * A -> A
    G   : A -> A
    H   : A -> A
    A   : A
    B   : A
    C   : A


strategies
  main-thread_test =
    s-enter(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "main-thread_test", "16,2,22,4")
    ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "17,4,22,4")
    ; test-suite(
        s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "17,15,17,28")
        ; !"thread-test"
      , s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "18,6,21,21")
        ; (s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "18,6,18,16") ; simple-test)
        ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "19,6,21,21")
        ; (s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "19,6,19,20") ; preorder-number)
        ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "20,6,21,21")
        ; (s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "20,6,20,21") ; postorder-number)
        ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "21,6,21,21")
        ; thread-list-test
      )
    < s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "main-thread_test", "16,2,22,4")
    + s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "main-thread_test", "16,2,22,4")
      ; fail

  simple-test =
    s-enter(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "simple-test", "24,2,30,1")
    ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "25,4,30,1")
    ; apply-test(
        s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "25,15,25,28")
        ; !"simple-test"
      , s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "26,3,27,39")
        ; (s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "26,3,26,17")
           ; \ t -> (t, 0) \)
        ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "27,3,27,39")
        ; 'thread(
            s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "27,10,27,37")
            ; \ (x, y) -> ( x
                          , <s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "27,26,27,28") ; add> (y, 1)
                          ) \
          )
      , s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "28,3,28,17")
        ; !F(
             G(A)
           , H(B)
           , C
           )
      , s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "29,3,29,21")
        ; !( F(
               G(A)
             , H(B)
             , C
             )
           , 3
           )
      )
    < s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "simple-test", "24,2,30,1")
    + s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "simple-test", "24,2,30,1")
      ; fail

  preorder-number =
    s-enter(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "preorder-number", "32,2,39,1")
    ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "33,4,39,1")
    ; apply-test(
        s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "33,15,33,32")
        ; !"preorder-number"
      , s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "34,3,36,16")
        ; (s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "34,3,34,17")
           ; \ t -> (t, 0) \)
        ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "35,3,36,16")
        ; rec x (
            s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "35,9,36,15")
            ; (s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "35,9,35,57")
               ; \ (t, n) -> Ann(
                               n
                             , <s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "35,29,35,37")
                                ; 'thread(
                                    s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "35,36,35,36") ; x
                                  )> ( t
                                     , <s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "35,45,35,47") ; add> (n, 1)
                                     )
                             ) \)
            ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "36,9,36,15")
            ; SwapAnn
          )
      , s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "37,3,37,17")
        ; !F(
             G(A)
           , H(B)
           , C
           )
      , s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "38,3,38,63")
        ; !( Ann(
               0
             , F(
                 Ann(
                   1
                 , G(Ann(2, A))
                 )
               , Ann(
                   3
                 , H(Ann(4, B))
                 )
               , Ann(5, C)
               )
             )
           , 6
           )
      )
    < s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "preorder-number", "32,2,39,1")
    + s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "preorder-number", "32,2,39,1")
      ; fail

  postorder-number =
    s-enter(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "postorder-number", "41,2,47,1")
    ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "42,4,47,1")
    ; apply-test(
        s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "42,15,42,33")
        ; !"postorder-number"
      , s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "43,3,44,28")
        ; (s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "43,3,43,17")
           ; \ t -> (t, 0) \)
        ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "44,3,44,28")
        ; rec x (
            s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "44,9,44,27")
            ; (s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "44,9,44,17")
               ; 'thread(
                   s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "44,16,44,16") ; x
                 ))
            ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "44,20,44,27")
            ; Annotate
          )
      , s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "45,3,45,17")
        ; !F(
             G(A)
           , H(B)
           , C
           )
      , s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "46,3,46,63")
        ; !( Ann(
               5
             , F(
                 Ann(
                   1
                 , G(Ann(0, A))
                 )
               , Ann(
                   3
                 , H(Ann(2, B))
                 )
               , Ann(4, C)
               )
             )
           , 6
           )
      )
    < s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "postorder-number", "41,2,47,1")
    + s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "postorder-number", "41,2,47,1")
      ; fail

  thread-list-test =
    s-enter(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "thread-list-test", "49,2,55,1")
    ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "50,4,55,1")
    ; apply-test(
        s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "50,15,50,33")
        ; !"thread-list-test"
      , s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "51,3,52,39")
        ; (s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "51,3,51,17")
           ; \ t -> (t, 0) \)
        ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "52,3,52,39")
        ; 'thread(
            s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "52,10,52,37")
            ; \ (x, y) -> ( x
                          , <s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "52,26,52,28") ; add> (y, 1)
                          ) \
          )
      , s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "53,3,53,16")
        ; ![G(A), H(B), C]
      , s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "54,3,54,20")
        ; !( [G(A), H(B), C]
           , 3
           )
      )
    < s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "thread-list-test", "49,2,55,1")
    + s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "thread-list-test", "49,2,55,1")
      ; fail


rules

  SwapAnn :
    Ann(n, (t, n')) -> <r-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "SwapAnn", "59,2,59,45")> (Ann(n, t), n')
    where r-enter(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "SwapAnn", "59,2,59,45")
          <+ r-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "SwapAnn", "59,2,59,45")
             ; fail

  Annotate :
    (t, n) -> <r-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "Annotate", "61,2,61,45")> ( Ann(n, t)
                                                                                                                           , <s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "61,36,61,38") ; add> (n, 1)
                                                                                                                           )
    where r-enter(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "Annotate", "61,2,61,45")
          <+ r-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "Annotate", "61,2,61,45")
             ; fail

  'thread(s) :
    (c#(ts), x) -> <r-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "thread", "63,2,65,44")> (c#(ts'), y)
    where r-enter(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "thread", "63,2,65,44")
          <+ r-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "thread", "63,2,65,44")
             ; fail
    where s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "65,10,65,44")
          ; (s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "65,10,65,32")
             ; <(s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "65,11,65,23")
                 ; thread-map(
                     s-step(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "65,22,65,22") ; s
                   ))> (ts, x)) => (ts', y)
          <+ r-exit(|"strategoxt/stratego-libraries/java-backend/test/strc2/thread_test.str", "thread", "63,2,65,44")
             ; fail