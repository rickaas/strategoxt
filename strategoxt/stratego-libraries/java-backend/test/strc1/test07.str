module test07

imports
  org.strategoxt.imp.debuggers.stratego.runtime


signature
  constructors
    Nil  : List(a)
    Cons : a * List(a) -> List(a)
    Zero : Nat
    Succ : Nat -> Nat
    Plus : Nat * Nat -> Nat


rules

  A :
    Plus(Zero, x) -> <r-exit(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "A", "13,2,13,23")> x
    where r-enter(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "A", "13,2,13,23")
          <+ r-exit(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "A", "13,2,13,23")
             ; fail

  B :
    Plus(Succ(x), y) -> <r-exit(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "B", "14,2,14,41")> Plus(x, Succ(y))
    where r-enter(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "B", "14,2,14,41")
          <+ r-exit(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "B", "14,2,14,41")
             ; fail


strategies
  try(s) =
    s-enter(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "try", "18,2,18,17")
    ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "18,11,18,17")
    ; (s-step(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "18,11,18,11") ; s
       <+ s-step(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "18,16,18,17") ; id)
    < s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "try", "18,2,18,17")
    + s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "try", "18,2,18,17")
      ; fail

  repeat(s) =
    s-enter(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "repeat", "20,2,21,19")
    ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "21,4,21,19")
    ; rec x (
        s-step(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "21,10,21,18")
        ; try(
            s-step(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "21,14,21,17")
            ; (s-step(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "21,14,21,14") ; s)
            ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "21,17,21,17")
            ; x
          )
      )
    < s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "repeat", "20,2,21,19")
    + s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "repeat", "20,2,21,19")
      ; fail

  eval =
    s-enter(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "eval", "23,2,24,16")
    ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "24,4,24,16")
    ; repeat(
        s-step(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "24,11,24,15")
        ; (s-step(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "24,11,24,11") ; A
           + s-step(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "24,15,24,15") ; B)
      )
    < s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "eval", "23,2,24,16")
    + s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "eval", "23,2,24,16")
      ; fail

  main-test07 =
    s-enter(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "main-test07", "26,2,28,7")
    ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "27,4,28,7")
    ; (s-step(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "27,4,27,38")
       ; !Plus(
            Succ(Succ(Zero))
          , Succ(Zero)
          ))
    ; s-step(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "28,4,28,7")
    ; eval
    < s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "main-test07", "26,2,28,7")
    + s-exit(|"strategoxt/stratego-libraries/java-backend/test/strc1/test07.str", "main-test07", "26,2,28,7")
      ; fail