module native-calls-compat

imports
  org.strategoxt.imp.debuggers.stratego.runtime


imports
  libstratego-lib


strategies
  override call =
             s-enter(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "call", "15,11,38,75")
             ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "17,4,38,75")
             ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "17,4,24,6")
                ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "17,4,17,19")
                   ; ?(program, args))
                ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "18,4,24,6")
                ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "18,4,18,99")
                   ; <(s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "18,5,18,90")
                       ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "18,5,18,29")
                          ; where(s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "18,11,18,28")
                                  ; is-substring(
                                      s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "18,24,18,27")
                                      ; !"."
                                    )))
                       ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "18,32,18,90")
                       ; not(s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "18,36,18,89")
                             ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "18,36,18,53")
                                ; is-substring(
                                    s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "18,49,18,52")
                                    ; !"/"
                                  )
                                + s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "18,57,18,89")
                                  ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "18,57,18,75")
                                     ; is-substring(
                                         s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "18,70,18,74")
                                         ; !"\\"
                                       )
                                     + s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "18,79,18,89") ; file-exists))))> program)
                ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "19,4,24,6")
                ; if s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "19,7,19,20")
                     ; <(s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "19,8,19,14") ; is-list)> args then
                    s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "20,6,20,60")
                    ; prim(
                        "SSL_EXT_java_call"
                      , program
                      , [program|args]
                      , 0
                      )
                  else
                    s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "22,6,23,48")
                    ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "22,6,22,59")
                       ; warn(|"Program arguments for <call> should be a list"))
                    ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "23,6,23,48")
                    ; prim("SSL_EXT_java_call", program, args, 0)
                  end
                <+ s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "26,4,38,75")
                   ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "26,4,33,75")
                      ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "26,4,26,19")
                         ; ?(program, args))
                      ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "28,4,33,75")
                      ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "28,4,28,38")
                         ; Stream(instream) := <s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "28,26,28,37") ; stdin-stream>)
                      ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "29,4,33,75")
                      ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "29,4,29,39")
                         ; Stream(outstream) := <s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "29,26,29,38") ; stdout-stream>)
                      ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "30,4,33,75")
                      ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "30,4,30,39")
                         ; Stream(errstream) := <s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "30,26,30,38") ; stderr-stream>)
                      ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "32,4,33,75")
                      ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "32,4,32,104")
                         ; log(
                           | Info()
                           , [ "Calling external tool "
                             , program
                             , " "
                             , <s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "32,59,32,96")
                                ; try(
                                    s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "32,63,32,95")
                                    ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "32,63,32,79")
                                       ; separate-by(|" "))
                                    ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "32,82,32,95")
                                    ; concat-strings
                                  )> args
                             ]
                           ))
                      ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "33,4,33,75")
                      ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "33,4,33,70")
                         ; prim(
                             "SSL_EXT_call"
                           , program
                           , args
                           , instream
                           , outstream
                           , errstream
                           )) => 0
                      <+ s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "35,4,38,75")
                         ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "35,4,35,51")
                            ; ?(program, args, instream, outstream, errstream))
                         ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "37,4,38,75")
                         ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "37,4,37,104")
                            ; log(
                              | Info()
                              , [ "Calling external tool "
                                , program
                                , " "
                                , <s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "37,59,37,96")
                                   ; try(
                                       s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "37,63,37,95")
                                       ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "37,63,37,79")
                                          ; separate-by(|" "))
                                       ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "37,82,37,95")
                                       ; concat-strings
                                     )> args
                                ]
                              ))
                         ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "38,4,38,75")
                         ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "38,4,38,70")
                            ; prim(
                                "SSL_EXT_call"
                              , program
                              , args
                              , instream
                              , outstream
                              , errstream
                              )) => 0))
             < s-exit(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "call", "15,11,38,75")
             + s-exit(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "call", "15,11,38,75")
               ; fail

  override read-from-prog(prog, args) =
             s-enter(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "read-from-prog", "40,11,50,32")
             ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "41,4,50,32")
             ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "41,4,41,39")
                ; (tempname, fd) := <s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "41,26,41,38") ; new-temp-file>)
             ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "42,4,50,32")
             ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "42,4,42,42")
                ; outstream := <s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "42,26,42,31") ; fdopen> (fd, "w"))
             ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "43,4,50,32")
             ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "43,4,43,38")
                ; Stream(instream) := <s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "43,26,43,37") ; stdin-stream>)
             ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "44,4,50,32")
             ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "44,4,44,39")
                ; Stream(errstream) := <s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "44,26,44,38") ; stderr-stream>)
             ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "45,4,50,32")
             ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "45,4,48,4")
                ; finally(
                    s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "46,6,46,28")
                    ; <(s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "46,7,46,10") ; call)> ( <s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "46,15,46,18") ; prog>
                                                                                                                                                                              , <s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "46,23,46,26") ; args>
                                                                                                                                                                              )
                  , s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "47,6,47,16")
                    ; <(s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "47,7,47,12") ; fclose)> fd
                  ))
             ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "49,4,50,32")
             ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "49,4,49,26")
                ; <(s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "49,5,49,16") ; ReadFromFile)> tempname)
             ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "50,4,50,32")
             ; where(s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "50,10,50,31")
                     ; <(s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "50,11,50,21") ; remove-file)> tempname)
             < s-exit(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "read-from-prog", "40,11,50,32")
             + s-exit(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "read-from-prog", "40,11,50,32")
               ; fail

  override fork(child) =
             s-enter(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "fork", "61,11,62,78")
             ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "62,4,62,78")
             ; fatal-err(|"Forking of applications is not supported on Java at this time")
             < s-exit(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "fork", "61,11,62,78")
             + s-exit(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "fork", "61,11,62,78")
               ; fail

  override fork(child, parent) =
             s-enter(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "fork", "64,11,65,78")
             ; s-step(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "65,4,65,78")
             ; fatal-err(|"Forking of applications is not supported on Java at this time")
             < s-exit(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "fork", "64,11,65,78")
             + s-exit(|"strategoxt/stratego-libraries/java-backend/java/runtime/org/strategoxt/lang/compat/override/native-calls-compat.str", "fork", "64,11,65,78")
               ; fail