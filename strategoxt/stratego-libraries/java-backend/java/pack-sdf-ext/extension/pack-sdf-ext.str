module pack-sdf-ext

imports
  org.strategoxt.imp.debuggers.stratego.runtime


imports
  libstratego-lib
  libstratego-sglr
  pack-sdf


rules

  pack-sdf-ext-postprocess :
    (path, asfix) -> <r-exit(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "pack-sdf-ext-postprocess", "16,2,17,54")> ( path
                                                                                                                                                                    , <s-step(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "17,29,17,46") ; remove-sdf-ext-top> asfix
                                                                                                                                                                    )
    where r-enter(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "pack-sdf-ext-postprocess", "16,2,17,54")
          <+ r-exit(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "pack-sdf-ext-postprocess", "16,2,17,54")
             ; fail

  remove-sdf-ext-top =
    s-enter(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext-top", "19,2,20,34")
    ; s-step(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "20,4,20,34")
    ; topdown(
        s-step(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "20,12,20,33")
        ; repeat(
            s-step(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "20,19,20,32") ; remove-sdf-ext
          )
      )
    < s-exit(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext-top", "19,2,20,34")
    + s-exit(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext-top", "19,2,20,34")
      ; fail

  remove-sdf-ext :
    appl(
      prod(
        _
      , _
      , attrs(
          [term(cons("namespacedef"))|_]
        )
      )
    , contents
    ) -> <r-exit(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext", "22,2,29,65")> symbol
    where r-enter(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext", "22,2,29,65")
          <+ r-exit(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext", "22,2,29,65")
             ; fail
    with s-step(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "29,6,29,65")
         ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "29,6,29,14") ; !contents) => [namespace, layout1, atequals, layout2, symbol]
         <+ r-exit(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext", "22,2,29,65")
            ; fail

  remove-sdf-ext :
    appl(
      prod(
        _
      , _
      , attrs(
          [term(cons("namespaceref2"))|_]
        )
      )
    , contents
    ) -> <r-exit(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext", "31,2,38,41")> symbol
    where r-enter(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext", "31,2,38,41")
          <+ r-exit(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext", "31,2,38,41")
             ; fail
    with s-step(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "38,6,38,41")
         ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "38,6,38,14") ; !contents) => [namespace, at, symbol]
         <+ r-exit(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext", "31,2,38,41")
            ; fail

  remove-sdf-ext :
    appl(
      prod(
        _
      , _
      , attrs(
          [term(cons("namespaceref"))|_]
        )
      )
    , contents
    ) -> <r-exit(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext", "40,2,105,11")> symbol
    where r-enter(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext", "40,2,105,11")
          <+ r-exit(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext", "40,2,105,11")
             ; fail
    with s-step(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "47,6,105,11")
         ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "47,6,47,33")
            ; (s-step(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "47,6,47,14") ; !contents) => [at, namespace])
         ; s-step(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "48,6,105,11")
         ; symbol := appl(
                       prod(
                         [cf(sort("Sort"))]
                       , cf(sort("Symbol"))
                       , attrs(
                           [term(cons("sort"))]
                         )
                       )
                     , [ appl(
                           prod(
                             [lex(sort("Sort"))]
                           , cf(sort("Sort"))
                           , no-attrs()
                           )
                         , [ appl(
                               prod(
                                 [ char-class(
                                     [range(65, 90)]
                                   )
                                 , lex(
                                     iter-star(
                                       char-class(
                                         [ 45
                                         , range(48, 57)
                                         , range(65, 90)
                                         , range(97, 122)
                                         ]
                                       )
                                     )
                                   )
                                 , char-class(
                                     [ range(48, 57)
                                     , range(65, 90)
                                     , range(97, 122)
                                     ]
                                   )
                                 ]
                               , lex(sort("Sort"))
                               , attrs(
                                   [term(cons("more-chars"))]
                                 )
                               )
                             , [ 73
                               , appl(
                                   list(
                                     lex(
                                       iter-star(
                                         char-class(
                                           [ 45
                                           , range(48, 57)
                                           , range(65, 90)
                                           , range(97, 122)
                                           ]
                                         )
                                       )
                                     )
                                   )
                                 , []
                                 )
                               , 68
                               ]
                             )
                           ]
                         )
                       ]
                     )
         <+ r-exit(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext", "40,2,105,11")
            ; fail

  remove-sdf-ext :
    appl(
      prod(
        [cf(sort("ATerm"))]
      , cf(sort("ATermAttribute"))
      , _
      )
    , [ contents@appl(
                   prod(
                     [cf(sort("AFun"))]
                   , cf(sort("ATerm"))
                   , _
                   )
                 , [ appl(
                       prod(
                         [cf(sort("StrCon"))]
                       , cf(sort("AFun"))
                       , _
                       )
                     , _
                     )
                   ]
                 )
      ]
    ) -> <r-exit(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext", "107,2,256,4")> appl(
                                                                                                                                                 prod(
                                                                                                                                                   [cf(sort("ATerm"))]
                                                                                                                                                 , cf(sort("ATermAttribute"))
                                                                                                                                                 , attrs(
                                                                                                                                                     [ term(cons("term"))
                                                                                                                                                     , avoid()
                                                                                                                                                     ]
                                                                                                                                                   )
                                                                                                                                                 )
                                                                                                                                               , [ appl(
                                                                                                                                                     prod(
                                                                                                                                                       [ cf(sort("AFun"))
                                                                                                                                                       , cf(opt(layout()))
                                                                                                                                                       , lit("(")
                                                                                                                                                       , cf(opt(layout()))
                                                                                                                                                       , cf(
                                                                                                                                                           iter-sep(
                                                                                                                                                             sort("ATerm")
                                                                                                                                                           , lit(",")
                                                                                                                                                           )
                                                                                                                                                         )
                                                                                                                                                       , cf(opt(layout()))
                                                                                                                                                       , lit(")")
                                                                                                                                                       ]
                                                                                                                                                     , cf(sort("ATerm"))
                                                                                                                                                     , attrs(
                                                                                                                                                         [term(cons("appl"))]
                                                                                                                                                       )
                                                                                                                                                     )
                                                                                                                                                   , [ appl(
                                                                                                                                                         prod(
                                                                                                                                                           [cf(sort("Literal"))]
                                                                                                                                                         , cf(sort("AFun"))
                                                                                                                                                         , no-attrs()
                                                                                                                                                         )
                                                                                                                                                       , [ appl(
                                                                                                                                                             prod(
                                                                                                                                                               [cf(sort("UQLiteral"))]
                                                                                                                                                             , cf(sort("Literal"))
                                                                                                                                                             , attrs(
                                                                                                                                                                 [term(cons("uqlit"))]
                                                                                                                                                               )
                                                                                                                                                             )
                                                                                                                                                           , [ appl(
                                                                                                                                                                 prod(
                                                                                                                                                                   [lex(sort("UQLiteral"))]
                                                                                                                                                                 , cf(sort("UQLiteral"))
                                                                                                                                                                 , no-attrs()
                                                                                                                                                                 )
                                                                                                                                                               , [ appl(
                                                                                                                                                                     prod(
                                                                                                                                                                       [ char-class(
                                                                                                                                                                           [range(97, 122)]
                                                                                                                                                                         )
                                                                                                                                                                       , lex(
                                                                                                                                                                           iter-star(
                                                                                                                                                                             char-class(
                                                                                                                                                                               [ 45
                                                                                                                                                                               , range(48, 57)
                                                                                                                                                                               , range(65, 90)
                                                                                                                                                                               , range(97, 122)
                                                                                                                                                                               ]
                                                                                                                                                                             )
                                                                                                                                                                           )
                                                                                                                                                                         )
                                                                                                                                                                       , char-class(
                                                                                                                                                                           [ range(48, 57)
                                                                                                                                                                           , range(65, 90)
                                                                                                                                                                           , range(97, 122)
                                                                                                                                                                           ]
                                                                                                                                                                         )
                                                                                                                                                                       ]
                                                                                                                                                                     , lex(sort("UQLiteral"))
                                                                                                                                                                     , attrs(
                                                                                                                                                                         [term(cons("more-chars"))]
                                                                                                                                                                       )
                                                                                                                                                                     )
                                                                                                                                                                   , [ 99
                                                                                                                                                                     , appl(
                                                                                                                                                                         list(
                                                                                                                                                                           lex(
                                                                                                                                                                             iter-star(
                                                                                                                                                                               char-class(
                                                                                                                                                                                 [ 45
                                                                                                                                                                                 , range(48, 57)
                                                                                                                                                                                 , range(65, 90)
                                                                                                                                                                                 , range(97, 122)
                                                                                                                                                                                 ]
                                                                                                                                                                               )
                                                                                                                                                                             )
                                                                                                                                                                           )
                                                                                                                                                                         )
                                                                                                                                                                       , [111, 110]
                                                                                                                                                                       )
                                                                                                                                                                     , 115
                                                                                                                                                                     ]
                                                                                                                                                                   )
                                                                                                                                                                 ]
                                                                                                                                                               )
                                                                                                                                                             ]
                                                                                                                                                           )
                                                                                                                                                         ]
                                                                                                                                                       )
                                                                                                                                                     , appl(
                                                                                                                                                         prod(
                                                                                                                                                           [cf(layout())]
                                                                                                                                                         , cf(opt(layout()))
                                                                                                                                                         , no-attrs()
                                                                                                                                                         )
                                                                                                                                                       , [ appl(
                                                                                                                                                             prod(
                                                                                                                                                               [lex(iter(layout()))]
                                                                                                                                                             , cf(layout())
                                                                                                                                                             , no-attrs()
                                                                                                                                                             )
                                                                                                                                                           , [ appl(
                                                                                                                                                                 list(lex(iter(layout())))
                                                                                                                                                               , []
                                                                                                                                                               )
                                                                                                                                                             ]
                                                                                                                                                           )
                                                                                                                                                         ]
                                                                                                                                                       )
                                                                                                                                                     , appl(
                                                                                                                                                         prod(
                                                                                                                                                           [char-class([40])]
                                                                                                                                                         , lit("(")
                                                                                                                                                         , no-attrs()
                                                                                                                                                         )
                                                                                                                                                       , [40]
                                                                                                                                                       )
                                                                                                                                                     , appl(
                                                                                                                                                         prod(
                                                                                                                                                           [cf(layout())]
                                                                                                                                                         , cf(opt(layout()))
                                                                                                                                                         , no-attrs()
                                                                                                                                                         )
                                                                                                                                                       , [ appl(
                                                                                                                                                             prod(
                                                                                                                                                               [lex(iter(layout()))]
                                                                                                                                                             , cf(layout())
                                                                                                                                                             , no-attrs()
                                                                                                                                                             )
                                                                                                                                                           , [ appl(
                                                                                                                                                                 list(lex(iter(layout())))
                                                                                                                                                               , []
                                                                                                                                                               )
                                                                                                                                                             ]
                                                                                                                                                           )
                                                                                                                                                         ]
                                                                                                                                                       )
                                                                                                                                                     , appl(
                                                                                                                                                         list(
                                                                                                                                                           cf(
                                                                                                                                                             iter-sep(
                                                                                                                                                               sort("ATerm")
                                                                                                                                                             , lit(",")
                                                                                                                                                             )
                                                                                                                                                           )
                                                                                                                                                         )
                                                                                                                                                       , [contents]
                                                                                                                                                       )
                                                                                                                                                     , appl(
                                                                                                                                                         prod(
                                                                                                                                                           [cf(layout())]
                                                                                                                                                         , cf(opt(layout()))
                                                                                                                                                         , no-attrs()
                                                                                                                                                         )
                                                                                                                                                       , [ appl(
                                                                                                                                                             prod(
                                                                                                                                                               [lex(iter(layout()))]
                                                                                                                                                             , cf(layout())
                                                                                                                                                             , no-attrs()
                                                                                                                                                             )
                                                                                                                                                           , [ appl(
                                                                                                                                                                 list(lex(iter(layout())))
                                                                                                                                                               , []
                                                                                                                                                               )
                                                                                                                                                             ]
                                                                                                                                                           )
                                                                                                                                                         ]
                                                                                                                                                       )
                                                                                                                                                     , appl(
                                                                                                                                                         prod(
                                                                                                                                                           [char-class([41])]
                                                                                                                                                         , lit(")")
                                                                                                                                                         , no-attrs()
                                                                                                                                                         )
                                                                                                                                                       , [41]
                                                                                                                                                       )
                                                                                                                                                     ]
                                                                                                                                                   )
                                                                                                                                                 ]
                                                                                                                                               )
    where r-enter(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext", "107,2,256,4")
          <+ r-exit(|"strategoxt/stratego-libraries/java-backend/java/pack-sdf-ext/extension/pack-sdf-ext.str", "remove-sdf-ext", "107,2,256,4")
             ; fail