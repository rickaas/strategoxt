module flatten-test

imports
  org.strategoxt.imp.debuggers.stratego.runtime


imports
  libstratego-lib


signature
  constructors
    Imports : List(String) -> Section
    Module  : String * List(a) -> Module(a)
    Content : String -> Section


strategies
  flatten-terms =
    s-enter(
    | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
    , "flatten-terms"
    , "12"
    , "2"
    , "15"
    , "54"
    )
    ; s-step(
      | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
      , "13"
      , "4"
      , "15"
      , "54"
      )
    ; flatten(
        s-step(
        | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
        , "13"
        , "12"
        , "13"
        , "32"
        )
        ; \ Imports(xs) -> xs \
      , s-step(
        | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
        , "14"
        , "5"
        , "14"
        , "28"
        )
        ; {n:
            s-step(
            | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
            , "14"
            , "10"
            , "14"
            , "27"
            )
            ; ?(n, Module(n, _))
          }
      , s-step(
        | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
        , "15"
        , "5"
        , "15"
        , "52"
        )
        ; \ Module(n, c) -> <s-step(
                             | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
                             , "15"
                             , "24"
                             , "15"
                             , "47"
                             )
                             ; filter(
                                 s-step(
                                 | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
                                 , "15"
                                 , "31"
                                 , "15"
                                 , "46"
                                 )
                                 ; not(s-step(
                                       | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
                                       , "15"
                                       , "35"
                                       , "15"
                                       , "45"
                                       )
                                       ; Imports(
                                           s-step(
                                           | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
                                           , "15"
                                           , "43"
                                           , "15"
                                           , "44"
                                           )
                                           ; id
                                         ))
                               )> c \
      )
    < s-exit(
      | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
      , "flatten-terms"
      , "12"
      , "2"
      , "15"
      , "54"
      )
    + s-exit(
      | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
      , "flatten-terms"
      , "12"
      , "2"
      , "15"
      , "54"
      )
      ; fail

  main =
    s-enter(
    | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
    , "main"
    , "17"
    , "2"
    , "20"
    , "4"
    )
    ; s-step(
      | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
      , "18"
      , "4"
      , "20"
      , "4"
      )
    ; test-suite(
        s-step(
        | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
        , "18"
        , "15"
        , "18"
        , "29"
        )
        ; !"flatten-test"
      , s-step(
        | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
        , "19"
        , "1"
        , "19"
        , "5"
        )
        ; test1
      )
    < s-exit(
      | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
      , "main"
      , "17"
      , "2"
      , "20"
      , "4"
      )
    + s-exit(
      | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
      , "main"
      , "17"
      , "2"
      , "20"
      , "4"
      )
      ; fail

  test1 =
    s-enter(
    | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
    , "test1"
    , "22"
    , "2"
    , "30"
    , "1"
    )
    ; s-step(
      | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
      , "23"
      , "4"
      , "30"
      , "1"
      )
    ; apply-test(
        s-step(
        | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
        , "23"
        , "15"
        , "23"
        , "22"
        )
        ; !"test1"
      , s-step(
        | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
        , "24"
        , "3"
        , "24"
        , "15"
        )
        ; flatten-terms
      , s-step(
        | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
        , "25"
        , "3"
        , "28"
        , "83"
        )
        ; !( "module1"
           , [ Module(
                 "module3"
               , [ Imports(["module1"])
                 , Content("module3")
                 ]
               )
             , Module(
                 "module2"
               , [Imports([]), Content("module2")]
               )
             , Module(
                 "module1"
               , [ Imports(["module2", "module3"])
                 , Content("module1")
                 ]
               )
             ]
           )
      , s-step(
        | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
        , "29"
        , "3"
        , "29"
        , "61"
        )
        ; ![ Content("module3")
           , Content("module2")
           , Content("module1")
           ]
      )
    < s-exit(
      | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
      , "test1"
      , "22"
      , "2"
      , "30"
      , "1"
      )
    + s-exit(
      | "strategoxt/stratego-libraries/strc/tests/test2/flatten-test.str"
      , "test1"
      , "22"
      , "2"
      , "30"
      , "1"
      )
      ; fail