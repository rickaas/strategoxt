module system-posix-xsi-test

imports
  org.strategoxt.imp.debuggers.stratego.runtime


imports
  libstratego-lib


strategies
  main-system-posix-xsi-test =
    s-enter(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "main-system-posix-xsi-test", "6,2,10,4")
    ; s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "7,4,10,4")
    ; test-suite(
        s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "7,15,7,33")
        ; !"system-posix-xsi"
      , s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "8,6,9,19")
        ; (s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "8,6,8,14") ; cwd-tests)
        ; s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "9,8,9,19")
        ; fileno-tests
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "main-system-posix-xsi-test", "6,2,10,4")
    + s-exit(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "main-system-posix-xsi-test", "6,2,10,4")
      ; fail


strategies
  cwd-tests =
    s-enter(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "cwd-tests", "17,2,20,63")
    ; s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "18,6,20,63")
    ; (s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "18,6,18,25")
       ; where(s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "18,12,18,24")
               ; (s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "18,12,18,17") ; getcwd) => cwd))
    ; s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "19,6,20,63")
    ; (s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "19,6,19,72")
       ; apply-and-check(
           s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "19,22,19,39")
           ; !"chdir to tmpdir"
         , s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "19,42,19,54")
           ; (s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "19,42,19,46") ; chdir)
           ; s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "19,49,19,54")
           ; getcwd
         , s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "19,57,19,64") ; temp-dir
         , s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "19,67,19,71") ; debug
         ))
    ; s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "20,6,20,63")
    ; apply-test(
        s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "20,17,20,35")
        ; !"chdir to old cwd"
      , s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "20,38,20,50")
        ; (s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "20,38,20,42") ; chdir)
        ; s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "20,45,20,50")
        ; getcwd
      , s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "20,53,20,56") ; !cwd
      , s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "20,59,20,62") ; !cwd
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "cwd-tests", "17,2,20,63")
    + s-exit(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "cwd-tests", "17,2,20,63")
      ; fail


strategies
  fileno-tests =
    s-enter(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "fileno-tests", "26,2,37,34")
    ; s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "27,4,37,34")
    ; (s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "27,4,27,45")
       ; where(s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "27,10,27,44")
               ; (s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "27,10,27,22") ; new-temp-file) => (tmp-name, tmp-fd)))
    ; s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "29,6,37,34")
    ; (s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "29,6,35,6")
       ; apply-test(
           s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "29,17,29,38")
           ; !"fileno on temp file"
         , s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "30,10,33,31")
           ; (s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "30,10,30,31")
              ; <(s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "30,11,30,16") ; fdopen)> (tmp-fd, "w"))
           ; s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "31,10,33,31")
           ; (s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "31,10,31,16") ; ?stream)
           ; s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "32,10,33,31")
           ; (s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "32,10,32,24")
              ; <(s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "32,11,32,16") ; fileno)> stream)
           ; s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "33,10,33,31")
           ; where(s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "33,16,33,30")
                   ; <(s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "33,17,33,22") ; fclose)> stream)
         , s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "34,10,34,16") ; !tmp-fd
         ))
    ; s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "37,6,37,34")
    ; where(s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "37,12,37,33")
            ; <(s-step(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "37,13,37,23") ; remove-file)> tmp-name)
    < s-exit(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "fileno-tests", "26,2,37,34")
    + s-exit(|"strategoxt/stratego-libraries/lib/tests/system-posix-xsi-test.str", "fileno-tests", "26,2,37,34")
      ; fail