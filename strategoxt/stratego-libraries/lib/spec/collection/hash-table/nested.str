module collection/hash-table/nested

imports
  org.strategoxt.imp.debuggers.stratego.runtime


imports
  collection/hash-table/common


signature
  constructors
    NestedTable : Hashtable -> TableValue
    Tables      : TableKey
    NewTable    : TableKey


strategies
  nestedtable-put(|keys, value) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put", "11,2,14,6")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "12,4,14,6")
    ; let forward =
            s-enter(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "forward", "12,8,12,78")
            ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "12,18,12,78")
            ; try(
                s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "12,22,12,77")
                ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "12,22,12,32")
                   ; ?NewTable())
                ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "12,35,12,77")
                ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "12,35,12,63")
                   ; !NestedTable(
                        <s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "12,49,12,61") ; new-hashtable>
                      ))
                ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "12,66,12,77")
                ; !( <s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "12,69,12,70") ; id>
                   , <s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "12,74,12,75") ; id>
                   )
              )
            < s-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "forward", "12,8,12,78")
            + s-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "forward", "12,8,12,78")
              ; fail
      in
        s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "13,8,13,49")
        ; nestedtable-put(
            s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "13,24,13,30") ; forward
          , s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "13,33,13,34") ; id
          | keys
          , value
          )
      end
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put", "11,2,14,6")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put", "11,2,14,6")
      ; fail

  nestedtable-put(forward|keys, value) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put", "16,2,17,45")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "17,4,17,45")
    ; nestedtable-put(
        s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "17,20,17,26") ; forward
      , s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "17,29,17,30") ; id
      | keys
      , value
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put", "16,2,17,45")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put", "16,2,17,45")
      ; fail

  nestedtable-put(forward, changed|keys, value) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put", "19,2,24,62")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "20,4,24,62")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "20,4,20,30")
       ; debug(
           s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "20,10,20,29")
           ; !"nestedtable-put: "
         ))
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "21,4,24,62")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "21,4,21,10") ; forward)
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "22,6,24,62")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "22,6,22,32")
       ; debug(
           s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "22,12,22,31")
           ; !"nestedtable-put: "
         ))
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "23,6,24,62")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "23,6,23,22")
       ; ?NestedTable(tbl))
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "24,6,24,62")
    ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "24,7,24,56")
        ; nestedtable-put-aux(
            s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "24,27,24,33") ; forward
          , s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "24,36,24,42") ; changed
          | tbl
          , value
          ))> keys
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put", "19,2,24,62")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put", "19,2,24,62")
      ; fail

  nestedtable-get(|keys) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get", "26,2,27,29")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "27,4,27,29")
    ; nestedtable-get(
        s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "27,20,27,21") ; id
      | keys
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get", "26,2,27,29")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get", "26,2,27,29")
      ; fail

  nestedtable-get(forward|keys) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get", "29,2,32,46")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "30,4,32,46")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "30,4,30,10") ; forward)
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "31,6,32,46")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "31,6,31,22")
       ; ?NestedTable(tbl))
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "32,6,32,46")
    ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "32,7,32,40")
        ; nestedtable-get-aux(
            s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "32,27,32,33") ; forward
          | tbl
          ))> keys
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get", "29,2,32,46")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get", "29,2,32,46")
      ; fail


strategies
  nestedtable-get-aux(forward|tbl):
    [] -> <r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get-aux", "44,2,45,12")> tbl
    where r-enter(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get-aux", "44,2,45,12")
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get-aux", "44,2,45,12")
             ; fail

  nestedtable-get-aux(forward|tbl):
    [key] -> <r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get-aux", "47,2,49,43")> value
    where r-enter(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get-aux", "47,2,49,43")
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get-aux", "47,2,49,43")
             ; fail
    where s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "49,10,49,43")
          ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "49,10,49,34")
             ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "49,11,49,29")
                 ; hashtable-get(|key))> tbl) => value
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get-aux", "47,2,49,43")
             ; fail

  nestedtable-get-aux(forward|tbl1):
    [key1, key2|keys] -> <r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get-aux", "51,2,54,62")> value
    where r-enter(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get-aux", "51,2,54,62")
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get-aux", "51,2,54,62")
             ; fail
    where s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "53,10,54,62")
          ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "53,10,53,66")
             ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "53,10,53,45")
                ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "53,11,53,39")
                    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "53,11,53,30")
                       ; hashtable-get(|key1))
                    ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "53,33,53,39")
                    ; forward)> tbl1) => NestedTable(tbl2))
          ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "54,3,54,62")
          ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "54,3,54,53")
             ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "54,4,54,38")
                 ; nestedtable-get-aux(
                     s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "54,24,54,30") ; forward
                   | tbl2
                   ))> [key2|keys]) => value
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-get-aux", "51,2,54,62")
             ; fail


strategies
  nestedtable-put-aux(forward, changed|tbl, value):
    [] -> <r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put-aux", "58,2,60,46")> tbl
    where r-enter(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put-aux", "58,2,60,46")
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put-aux", "58,2,60,46")
             ; fail
    where s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "60,10,60,46")
          ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "60,10,60,40")
             ; debug(
                 s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "60,16,60,39")
                 ; !"nestedtable-put-aux: "
               ))
          ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "60,43,60,46")
          ; fail
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put-aux", "58,2,60,46")
             ; fail

  nestedtable-put-aux(forward, changed|tbl, value):
    [key] -> <r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put-aux", "62,2,66,28")> tbl
    where r-enter(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put-aux", "62,2,66,28")
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put-aux", "62,2,66,28")
             ; fail
    where s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "64,10,66,28")
          ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "64,10,64,40")
             ; debug(
                 s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "64,16,64,39")
                 ; !"nestedtable-put-aux: "
               ))
          ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "65,1,66,28")
          ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "65,1,65,32")
             ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "65,2,65,27")
                 ; hashtable-put(|key, value))> tbl)
          ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "66,3,66,28")
          ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "66,4,66,10") ; changed)> NestedTable(tbl)
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put-aux", "62,2,66,28")
             ; fail

  nestedtable-put-aux(forward, changed|tbl1, value):
    [key1, key2|keys] -> <r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put-aux", "68,2,76,69")> value
    where r-enter(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put-aux", "68,2,76,69")
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put-aux", "68,2,76,69")
             ; fail
    where s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "70,10,76,69")
          ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "70,10,70,40")
             ; debug(
                 s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "70,16,70,39")
                 ; !"nestedtable-put-aux: "
               ))
          ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "71,1,76,69")
          ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "71,2,75,41")
             ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "71,2,71,58")
                ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "71,2,71,37")
                   ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "71,3,71,31")
                       ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "71,3,71,22")
                          ; hashtable-get(|key1))
                       ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "71,25,71,31")
                       ; forward)> tbl1) => NestedTable(tbl2)
                <+ s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "72,14,75,41")
                   ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "72,14,72,59")
                      ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "72,14,72,33")
                         ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "72,15,72,21") ; forward)> NewTable()) => (x, NestedTable(tbl2)))
                   ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "73,16,75,41")
                   ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "73,16,73,45")
                      ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "73,17,73,39")
                          ; hashtable-put(|key1, x))> tbl1)
                   ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "74,9,75,41")
                   ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "74,10,75,35")
                       ; (s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "74,10,74,40")
                          ; hashtable-push(|Tables(), key1))
                       ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "75,9,75,35")
                       ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "75,10,75,16") ; changed)> NestedTable(tbl1))> tbl1))
          ; s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "76,3,76,69")
          ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "76,4,76,54")
              ; nestedtable-put-aux(
                  s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "76,24,76,30") ; forward
                , s-step(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "76,33,76,39") ; changed
                | tbl2
                , value
                ))> [key2|keys]
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/collection/hash-table/nested.str", "nestedtable-put-aux", "68,2,76,69")
             ; fail