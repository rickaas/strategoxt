module strategy/traversal/environment

imports
  org.strategoxt.imp.debuggers.stratego.runtime


rules

  all-dist(s) :
    (t, env) -> <r-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "all-dist", "7,2,8,41")> <s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "8,17,8,38")
                                                                                                                                ; all(s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "8,21,8,37")
                                                                                                                                      ; \ x -> <s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "8,28,8,28") ; s> (x, env) \)> t
    where r-enter(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "all-dist", "7,2,8,41")
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "all-dist", "7,2,8,41")
             ; fail

  one-dist(s) :
    (t, env) -> <r-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "one-dist", "10,2,11,41")> <s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "11,17,11,38")
                                                                                                                                  ; one(s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "11,21,11,37")
                                                                                                                                        ; \ x -> <s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "11,28,11,28") ; s> (x, env) \)> t
    where r-enter(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "one-dist", "10,2,11,41")
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "one-dist", "10,2,11,41")
             ; fail

  d(s) :
    (t, env) -> <r-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "d", "13,2,14,20")> <s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "14,17,14,17") ; s> t
    where r-enter(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "d", "13,2,14,20")
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "d", "13,2,14,20")
             ; fail

  t(s) :
    (t, env) -> <r-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "t", "16,2,17,26")> ( <s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "17,18,17,18") ; s> t
                                                                                                                          , env
                                                                                                                          )
    where r-enter(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "t", "16,2,17,26")
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "t", "16,2,17,26")
             ; fail

  coll(s) :
    f#(xs) -> <r-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "coll", "19,2,21,34")> (f#(ys), zs)
    where r-enter(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "coll", "19,2,21,34")
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "coll", "19,2,21,34")
             ; fail
    where s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "21,10,21,34")
          ; (s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "21,10,21,22")
             ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "21,11,21,18")
                 ; unzip(
                     s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "21,17,21,17") ; s
                   ))> xs) => (ys, zs)
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "coll", "19,2,21,34")
             ; fail


strategies
  env-alltd(s) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "env-alltd", "25,2,26,26")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "26,4,26,26")
    ; rec x (
        s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "26,10,26,25")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "26,10,26,10") ; s
           <+ s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "26,15,26,25")
              ; all-dist(
                  s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "26,24,26,24") ; x
                ))
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "env-alltd", "25,2,26,26")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "env-alltd", "25,2,26,26")
      ; fail

  env-topdown(s) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "env-topdown", "28,2,29,24")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "29,4,29,24")
    ; rec x (
        s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "29,10,29,23")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "29,10,29,10") ; s)
        ; s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "29,13,29,23")
        ; all-dist(
            s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "29,22,29,22") ; x
          )
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "env-topdown", "28,2,29,24")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "env-topdown", "28,2,29,24")
      ; fail

  env-topdown(s, skip : ( term -> term ) * term -> term) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "env-topdown", "31,2,32,37")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "32,4,32,37")
    ; rec x (
        s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "32,10,32,36")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "32,10,32,10") ; s)
        ; s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "32,14,32,35")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "32,14,32,20")
           ; skip(
               s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "32,19,32,19") ; x
             )
           <+ s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "32,25,32,35")
              ; all-dist(
                  s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "32,34,32,34") ; x
                ))
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "env-topdown", "31,2,32,37")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "env-topdown", "31,2,32,37")
      ; fail

  env-bottomup(s) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "env-bottomup", "34,2,35,36")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "35,4,35,36")
    ; rec x (
        s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "35,10,35,35")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "35,10,35,32")
           ; split(
               s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "35,16,35,26")
               ; all-dist(
                   s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "35,25,35,25") ; x
                 )
             , s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "35,29,35,31") ; Snd
             ))
        ; s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "35,35,35,35")
        ; s
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "env-bottomup", "34,2,35,36")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "env-bottomup", "34,2,35,36")
      ; fail

  thread-replacement(s) :
    (c#(ts), x) -> <r-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "thread-replacement", "43,2,45,44")> (c#(ts'), y)
    where r-enter(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "thread-replacement", "43,2,45,44")
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "thread-replacement", "43,2,45,44")
             ; fail
    where s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "45,10,45,44")
          ; (s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "45,10,45,32")
             ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "45,11,45,23")
                 ; thread-map(
                     s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "45,22,45,22") ; s
                   ))> (ts, x)) => (ts', y)
          <+ r-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "thread-replacement", "43,2,45,44")
             ; fail

  thread-alltd(s) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "thread-alltd", "47,2,48,36")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "48,4,48,36")
    ; rec x (
        s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "48,10,48,35")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "48,10,48,10") ; s
           <+ s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "48,15,48,35")
              ; thread-replacement(
                  s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "48,34,48,34") ; x
                ))
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "thread-alltd", "47,2,48,36")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "thread-alltd", "47,2,48,36")
      ; fail

  thread-bottomup(s) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "thread-bottomup", "50,2,51,34")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "51,4,51,34")
    ; rec x (
        s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "51,10,51,33")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "51,10,51,30")
           ; thread-replacement(
               s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "51,29,51,29") ; x
             ))
        ; s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "51,33,51,33")
        ; s
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "thread-bottomup", "50,2,51,34")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "thread-bottomup", "50,2,51,34")
      ; fail

  count-bottomup(s) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "count-bottomup", "53,2,54,44")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "54,4,54,44")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "54,4,54,12")
       ; !( <s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "54,7,54,8") ; id>
          , 0
          ))
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "54,15,54,44")
    ; thread-bottomup(
        s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "54,31,54,43")
        ; try(
            s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "54,35,54,42")
            ; ( s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "54,36,54,36") ; s
              , s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "54,39,54,41") ; inc
              )
          )
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "count-bottomup", "53,2,54,44")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "count-bottomup", "53,2,54,44")
      ; fail

  env-oncetd(s) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "env-oncetd", "56,2,57,26")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "57,4,57,26")
    ; rec x (
        s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "57,10,57,25")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "57,10,57,10") ; s
           <+ s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "57,15,57,25")
              ; one-dist(
                  s-step(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "57,24,57,24") ; x
                ))
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "env-oncetd", "56,2,57,26")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/strategy/traversal/environment.str", "env-oncetd", "56,2,57,26")
      ; fail