module system/posix/file-abstractions

imports
  org.strategoxt.imp.debuggers.stratego.runtime


imports
  system/posix/file


strategies
  abspath =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "abspath", "13,2,16,46")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "14,6,16,46")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "14,6,14,15") ; is-abspath
       < s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "15,6,15,7") ; id
       + s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "16,6,16,46")
         ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "16,7,16,20") ; concat-strings)> [ <s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "16,25,16,30") ; getcwd> ()
                                                                                                                                   , "/"
                                                                                                                                   , <s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "16,43,16,44") ; id>
                                                                                                                                   ])
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "abspath", "13,2,16,46")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "abspath", "13,2,16,46")
      ; fail

  file-newer =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "file-newer", "18,2,19,45")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "19,4,19,45")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "19,4,19,41")
       ; ( s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "19,5,19,21") ; modification-time
         , s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "19,24,19,40") ; modification-time
         ))
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "19,44,19,45")
    ; gt
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "file-newer", "18,2,19,45")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "file-newer", "18,2,19,45")
      ; fail


overlays
  Read = R_OK()

  Write = W_OK()

  Execute = X_OK()

  Existence = F_OK()


strategies
  file-exists =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "file-exists", "33,2,34,28")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "34,4,34,28")
    ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "34,5,34,10") ; access)> ( <s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "34,15,34,16") ; id>
                                                                                                                      , [F_OK()]
                                                                                                                      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "file-exists", "33,2,34,28")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "file-exists", "33,2,34,28")
      ; fail

  can-read-file =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "can-read-file", "39,2,40,28")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "40,4,40,28")
    ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "40,5,40,10") ; access)> ( <s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "40,15,40,16") ; id>
                                                                                                                      , [R_OK()]
                                                                                                                      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "can-read-file", "39,2,40,28")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "can-read-file", "39,2,40,28")
      ; fail

  is-readable =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "is-readable", "42,2,42,28")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "42,16,42,28")
    ; can-read-file
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "is-readable", "42,2,42,28")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "is-readable", "42,2,42,28")
      ; fail

  can-write-file =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "can-write-file", "47,2,48,28")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "48,4,48,28")
    ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "48,5,48,10") ; access)> ( <s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "48,15,48,16") ; id>
                                                                                                                      , [W_OK()]
                                                                                                                      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "can-write-file", "47,2,48,28")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "can-write-file", "47,2,48,28")
      ; fail

  is-writable =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "is-writable", "50,2,50,29")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "50,16,50,29")
    ; can-write-file
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "is-writable", "50,2,50,29")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "is-writable", "50,2,50,29")
      ; fail

  can-execute-file =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "can-execute-file", "55,2,56,28")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "56,4,56,28")
    ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "56,5,56,10") ; access)> ( <s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "56,15,56,16") ; id>
                                                                                                                      , [X_OK()]
                                                                                                                      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "can-execute-file", "55,2,56,28")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "can-execute-file", "55,2,56,28")
      ; fail

  is-executable =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "is-executable", "58,2,58,33")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "58,18,58,33")
    ; can-execute-file
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "is-executable", "58,2,58,33")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "is-executable", "58,2,58,33")
      ; fail

  can-create-file =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "can-create-file", "64,2,65,33")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "65,4,65,33")
    ; where(s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "65,10,65,32")
            ; (s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "65,10,65,16") ; dirname)
            ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "65,19,65,32")
            ; can-write-file)
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "can-create-file", "64,2,65,33")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "can-create-file", "64,2,65,33")
      ; fail


strategies
  find-in-path(strict|path) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-in-path", "86,2,91,6")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "87,4,91,6")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "87,4,87,8") ; ?file)
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "88,8,90,75")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "88,8,88,18") ; file-exists
       <+ s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "89,9,90,75")
          ; (s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "89,9,89,72")
             ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "89,10,89,66")
                 ; fetch-elem(
                     s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "89,21,89,65")
                     ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "89,22,89,48")
                         ; (s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "89,22,89,35") ; concat-strings)
                         ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "89,38,89,48")
                         ; file-exists)> [ <s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "89,53,89,54") ; id>
                                         , "/"
                                         , file
                                         ]
                   ))> path
             <+ s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "90,9,90,75")
                ; if s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "90,12,90,17") ; strict then
                    s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "90,24,90,61")
                    ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "90,25,90,35") ; fatal-error)> ["no such file: ", file]
                  else
                    s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "90,68,90,71") ; fail
                  end))
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-in-path", "86,2,91,6")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-in-path", "86,2,91,6")
      ; fail

  find-in-path(|path) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-in-path", "102,2,103,24")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "103,4,103,24")
    ; find-in-path(
        s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "103,17,103,18") ; id
      | path
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-in-path", "102,2,103,24")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-in-path", "102,2,103,24")
      ; fail

  find-in-path =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-in-path", "118,2,119,48")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "119,4,119,48")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "119,4,119,16")
       ; ?(file, path))
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "119,19,119,48")
    ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "119,20,119,42")
        ; find-in-path(
            s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "119,33,119,36") ; fail
          | path
          ))> file
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-in-path", "118,2,119,48")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-in-path", "118,2,119,48")
      ; fail

  find-in-path(mkpath) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-in-path", "125,2,126,26")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "126,4,126,26")
    ; find-in-path(
      | <s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "126,19,126,24") ; mkpath>
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-in-path", "125,2,126,26")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-in-path", "125,2,126,26")
      ; fail

  find-file(|ext, path) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-file", "141,2,143,28")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "142,4,143,28")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "142,4,142,28")
       ; guarantee-extension(|ext))
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "143,6,143,28")
    ; find-in-path(
        s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "143,19,143,22") ; fail
      | path
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-file", "141,2,143,28")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-file", "141,2,143,28")
      ; fail

  find-file(|ext) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-file", "145,2,147,33")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "146,4,147,33")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "146,4,146,16")
       ; ?(file, path))
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "147,6,147,33")
    ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "147,7,147,27")
        ; find-file(|ext, path))> file
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-file", "145,2,147,33")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-file", "145,2,147,33")
      ; fail

  find-file(ext) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-file", "152,2,153,20")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "153,4,153,20")
    ; find-file(
      | <s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "153,16,153,18") ; ext>
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-file", "152,2,153,20")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-file", "152,2,153,20")
      ; fail

  find-file(mkpath, ext) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-file", "164,2,166,28")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "165,4,166,28")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "165,4,165,30")
       ; guarantee-extension(
         | <s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "165,26,165,28") ; ext>
         ))
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "166,6,166,28")
    ; find-in-path(
      | <s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "166,21,166,26") ; mkpath>
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-file", "164,2,166,28")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "find-file", "164,2,166,28")
      ; fail


strategies
  new-file =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "new-file", "178,2,180,65")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "179,4,180,65")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "179,4,179,66")
       ; obsolete(
           s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "179,13,179,65")
           ; !"new-file; use new-temp-file or XTC temporary files"
         ))
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "180,6,180,65")
    ; rec x (
        s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "180,12,180,64")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "180,12,180,43")
           ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "180,13,180,24") ; conc-strings)> ( <s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "180,29,180,31") ; new> ()
                                                                                                                                      , ".tmp"
                                                                                                                                      ))
        ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "180,46,180,64")
        ; try(
            s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "180,50,180,63")
            ; (s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "180,50,180,60") ; file-exists)
            ; s-step(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "180,63,180,63")
            ; x
          )
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "new-file", "178,2,180,65")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/system/posix/file-abstractions.str", "new-file", "178,2,180,65")
      ; fail