module util/sunit

imports
  org.strategoxt.imp.debuggers.stratego.runtime


imports
  system/io/file
  system/io/dir
  system/io/char
  system/io/term


strategies
  test-suite(name, tests) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "test-suite", "13,2,19,23")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "14,4,19,23")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "14,4,14,7") ; name)
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "15,6,19,23")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "15,6,15,27")
       ; debug(
           s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "15,12,15,26")
           ; !"test suite: "
         ))
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "16,6,19,23")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "16,6,16,16") ; init-record)
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "17,6,19,23")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "17,6,17,10") ; tests)
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "18,6,19,23")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "18,6,18,16") ; report-test)
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "19,6,19,23")
    ; check-for-failures
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "test-suite", "13,2,19,23")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "test-suite", "13,2,19,23")
      ; fail

  apply-test(name, s, in-term, out) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-test", "21,2,27,73")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "22,4,27,73")
    ; do-test(
        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "22,12,22,15") ; name
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "23,12,27,72")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "23,12,23,95")
           ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "23,13,23,87")
              ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "23,13,23,42")
                 ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "23,13,23,39")
                    ; sunit-create-input(
                        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "23,32,23,38") ; in-term
                      ))
                 ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "23,42,23,42")
                 ; s
                 <+ s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "23,47,23,87")
                    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "23,47,23,81")
                       ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "23,48,23,60") ; print-failure)> "  strategy failed")
                    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "23,84,23,87")
                    ; fail)) => tmp)
        ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "24,7,27,72")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "24,7,24,38")
           ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "24,7,24,30")
              ; sunit-create-output(
                  s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "24,27,24,29") ; out
                )) => tmp')
        ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "25,6,27,71")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "25,7,25,18")
           ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "25,7,25,11") ; !tmp') => tmp
           <+ s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "26,18,27,71")
              ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "26,19,27,64")
                 ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "26,19,26,63")
                    ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "26,20,26,58")
                        ; print-failure(|"  result not equal : "))> tmp)
                 ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "27,19,27,64")
                 ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "27,20,27,58")
                     ; print-failure(|"  expected         : "))> tmp')
              ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "27,68,27,71")
              ; fail)
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-test", "21,2,27,73")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-test", "21,2,27,73")
      ; fail

  apply-test(name, s, in-term) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-test", "29,2,32,4")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "30,4,32,4")
    ; do-test(
        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "30,12,30,15") ; name
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "31,7,31,81")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "31,7,31,36")
           ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "31,7,31,33")
              ; sunit-create-input(
                  s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "31,26,31,32") ; in-term
                ))
           ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "31,36,31,36")
           ; s
           <+ s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "31,41,31,81")
              ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "31,41,31,75")
                 ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "31,42,31,54") ; print-failure)> "  strategy failed")
              ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "31,78,31,81")
              ; fail)
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-test", "29,2,32,4")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-test", "29,2,32,4")
      ; fail

  apply-and-check(name, s, in-term, check) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-check", "34,2,38,4")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "35,4,38,4")
    ; do-test(
        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "35,12,35,15") ; name
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "36,6,37,60")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "36,7,36,85")
           ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "36,7,36,36")
              ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "36,7,36,33")
                 ; sunit-create-input(
                     s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "36,26,36,32") ; in-term
                   ))
              ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "36,36,36,36")
              ; s
              <+ s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "36,42,36,85")
                 ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "36,42,36,79")
                    ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "36,43,36,55") ; print-failure)> "  application failed")
                 ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "36,82,36,85")
                 ; fail))
        ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "37,9,37,59")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "37,9,37,13") ; check
           <+ s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "37,19,37,58")
              ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "37,19,37,52")
                 ; print-failure(|"  check failed: "))
              ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "37,55,37,58")
              ; fail)
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-check", "34,2,38,4")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-check", "34,2,38,4")
      ; fail

  apply-and-fail(name, s, in-term) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-fail", "40,2,41,40")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "41,4,41,40")
    ; apply-and-fail(
        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "41,19,41,22") ; name
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "41,25,41,25") ; s
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "41,28,41,34") ; in-term
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "41,37,41,39")
        ; !()
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-fail", "40,2,41,40")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-fail", "40,2,41,40")
      ; fail

  apply-and-fail(name, s, in-term, out) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-fail", "43,2,46,66")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "44,4,46,66")
    ; do-test(
        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "44,12,44,15") ; name
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "45,6,46,64")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "45,7,45,41")
           ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "45,7,45,33")
              ; sunit-create-input(
                  s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "45,26,45,32") ; in-term
                ))
           ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "45,36,45,41")
           ; not(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "45,40,45,40") ; s)
           <+ s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "46,16,46,64")
              ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "46,16,46,58")
                 ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "46,17,46,29") ; print-failure)> "  succeeded (should fail)")
              ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "46,61,46,64")
              ; fail)
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-fail", "43,2,46,66")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-fail", "43,2,46,66")
      ; fail

  apply-and-show(name, s, in-term) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-show", "48,2,52,11")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "49,4,52,11")
    ; do-test(
        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "49,12,49,15") ; name
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "50,5,51,52")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "50,6,50,80")
           ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "50,6,50,35")
              ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "50,6,50,32")
                 ; sunit-create-input(
                     s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "50,25,50,31") ; in-term
                   ))
              ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "50,35,50,35")
              ; s
              <+ s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "50,40,50,80")
                 ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "50,40,50,74")
                    ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "50,41,50,53") ; print-failure)> "  strategy failed")
                 ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "50,77,50,80")
                 ; fail))
        ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "51,14,51,52")
        ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "51,15,51,19") ; debug)> [ "  succeeded; result: "
                                                                                                      , <s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "51,49,51,50") ; id>
                                                                                                      ]
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-show", "48,2,52,11")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-show", "48,2,52,11")
      ; fail


strategies
  apply-test(s|name, in-term, out) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-test", "59,2,60,39")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "60,4,60,39")
    ; apply-test(
        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "60,15,60,19") ; !name
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "60,22,60,22") ; s
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "60,25,60,32") ; !in-term
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "60,35,60,38") ; !out
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-test", "59,2,60,39")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-test", "59,2,60,39")
      ; fail

  apply-test(s|name, in-term) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-test", "62,2,63,33")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "63,4,63,33")
    ; apply-test(
        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "63,15,63,19") ; !name
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "63,22,63,22") ; s
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "63,25,63,32") ; !in-term
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-test", "62,2,63,33")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-test", "62,2,63,33")
      ; fail

  apply-and-check(s|name, in-term, check) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-check", "65,2,66,46")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "66,4,66,46")
    ; apply-and-check(
        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "66,20,66,24") ; !name
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "66,27,66,27") ; s
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "66,30,66,37") ; !in-term
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "66,40,66,45") ; !check
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-check", "65,2,66,46")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-check", "65,2,66,46")
      ; fail

  apply-and-fail(s|name, in-term) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-fail", "68,2,69,37")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "69,4,69,37")
    ; apply-and-fail(
        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "69,19,69,23") ; !name
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "69,26,69,26") ; s
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "69,29,69,36") ; !in-term
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-fail", "68,2,69,37")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-fail", "68,2,69,37")
      ; fail

  apply-and-fail(s|name, in-term, out) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-fail", "71,2,72,43")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "72,4,72,43")
    ; apply-and-fail(
        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "72,19,72,23") ; !name
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "72,26,72,26") ; s
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "72,29,72,36") ; !in-term
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "72,39,72,42") ; !out
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-fail", "71,2,72,43")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-fail", "71,2,72,43")
      ; fail

  apply-and-show(s|name, in-term) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-show", "74,2,75,37")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "75,4,75,37")
    ; apply-and-show(
        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "75,19,75,23") ; !name
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "75,26,75,26") ; s
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "75,29,75,36") ; !in-term
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-show", "74,2,75,37")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "apply-and-show", "74,2,75,37")
      ; fail


strategies
  sunit-create-input(s) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "sunit-create-input", "82,2,83,64")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "83,4,83,64")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "83,4,83,4") ; s
       <+ s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "83,9,83,64")
          ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "83,9,83,58")
             ; say(
                 s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "83,13,83,57")
                 ; !"error: input strategy for this test failed"
               ))
          ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "83,61,83,64")
          ; fail)
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "sunit-create-input", "82,2,83,64")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "sunit-create-input", "82,2,83,64")
      ; fail

  sunit-create-output(s) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "sunit-create-output", "85,2,86,65")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "86,4,86,65")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "86,4,86,4") ; s
       <+ s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "86,9,86,65")
          ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "86,9,86,59")
             ; say(
                 s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "86,13,86,58")
                 ; !"error: output strategy for this test failed"
               ))
          ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "86,62,86,65")
          ; fail)
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "sunit-create-output", "85,2,86,65")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "sunit-create-output", "85,2,86,65")
      ; fail

  do-test(nr, s) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "do-test", "88,2,91,24")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "89,4,91,24")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "89,4,89,19")
       ; where(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "89,10,89,18")
               ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "89,10,89,11") ; nr)
               ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "89,14,89,18")
               ; debug))
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "90,7,91,23")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "90,7,90,30")
       ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "90,7,90,14")
          ; where(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "90,13,90,13") ; s))
       ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "90,17,90,30")
       ; record-success
       <+ s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "91,10,91,23") ; record-failure)
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "do-test", "88,2,91,24")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "do-test", "88,2,91,24")
      ; fail

  testing(nr, s) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "testing", "93,2,95,34")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "94,4,95,34")
    ; do-test(
        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "94,12,94,13") ; nr
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "94,16,95,33")
        ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "94,16,94,41")
           ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "94,16,94,16") ; s)
           ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "94,19,94,41")
           ; debug(
               s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "94,25,94,40")
               ; !"  succeeded: "
             )
           <+ s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "95,8,95,33")
              ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "95,8,95,27")
                 ; debug(
                     s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "95,14,95,26")
                     ; !"  failed: "
                   ))
              ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "95,30,95,33")
              ; fail)
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "testing", "93,2,95,34")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "testing", "93,2,95,34")
      ; fail

  do-test(s|nr) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "do-test", "97,2,99,50")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "98,4,99,50")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "98,4,98,20")
       ; where(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "98,10,98,18")
               ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "98,11,98,15") ; debug)> nr))
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "99,6,99,48")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "99,6,99,30")
       ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "99,6,99,13")
          ; where(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "99,12,99,12") ; s))
       ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "99,17,99,30")
       ; record-success
       <+ s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "99,35,99,48") ; record-failure)
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "do-test", "97,2,99,50")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "do-test", "97,2,99,50")
      ; fail


strategies
  init-record =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "init-record", "107,2,108,9")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "108,4,108,9")
    ; !(0, 0)
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "init-record", "107,2,108,9")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "init-record", "107,2,108,9")
      ; fail

  record-success =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "record-success", "113,2,114,12")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "114,4,114,12")
    ; ( s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "114,5,114,7") ; inc
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "114,10,114,11") ; id
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "record-success", "113,2,114,12")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "record-success", "113,2,114,12")
      ; fail

  record-failure =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "record-failure", "119,2,120,12")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "120,4,120,12")
    ; ( s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "120,5,120,6") ; id
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "120,9,120,11") ; inc
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "record-failure", "119,2,120,12")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "record-failure", "119,2,120,12")
      ; fail

  check-for-failures =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "check-for-failures", "125,2,126,10")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "126,4,126,10")
    ; ( s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "126,5,126,6") ; id
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "126,9,126,9") ; 0
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "check-for-failures", "125,2,126,10")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "check-for-failures", "125,2,126,10")
      ; fail

  report-test =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "report-test", "131,2,132,48")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "132,4,132,48")
    ; ( s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "132,5,132,25")
        ; debug(
            s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "132,11,132,24")
            ; !"successes: "
          )
      , s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "132,28,132,47")
        ; debug(
            s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "132,34,132,46")
            ; !"failures: "
          )
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "report-test", "131,2,132,48")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "report-test", "131,2,132,48")
      ; fail

  print-failure =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "print-failure", "134,2,136,10")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "135,4,136,10")
    ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "135,4,135,23") ; sunit-failure-string)
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "136,6,136,10")
    ; debug
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "print-failure", "134,2,136,10")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "print-failure", "134,2,136,10")
      ; fail

  print-failure(|msg) =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "print-failure", "138,2,139,36")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "139,4,139,36")
    ; debug(
        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "139,10,139,35")
        ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "139,11,139,30") ; sunit-failure-string)> msg
      )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "print-failure", "138,2,139,36")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "print-failure", "138,2,139,36")
      ; fail


strategies
  sunit-failure-string =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "sunit-failure-string", "146,2,153,6")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "147,4,153,6")
    ; if s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "147,7,147,40")
         ; (s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "147,7,147,30")
            ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "147,8,147,13") ; getenv)> "ENABLE_COLORS") => "true" then
        s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "148,6,152,6")
        ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "148,7,148,20") ; concat-strings)> [ <s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "149,9,149,23") ; sunit-color-red>
                                                                                                                , <s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "150,9,150,10") ; id>
                                                                                                                , <s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "151,9,151,25") ; sunit-color-plain>
                                                                                                                ]
      end
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "sunit-failure-string", "146,2,153,6")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "sunit-failure-string", "146,2,153,6")
      ; fail

  sunit-color-red =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "sunit-color-red", "155,2,156,52")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "156,4,156,52")
    ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "156,5,156,16") ; conc-strings)> ( <s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "156,21,156,34") ; implode-string> [27]
                                                                                                          , "[01;31m"
                                                                                                          )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "sunit-color-red", "155,2,156,52")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "sunit-color-red", "155,2,156,52")
      ; fail

  sunit-color-plain =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "sunit-color-plain", "158,2,159,47")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "159,4,159,47")
    ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "159,5,159,16") ; conc-strings)> ( <s-step(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "159,21,159,34") ; implode-string> [27]
                                                                                                          , "[m"
                                                                                                          )
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "sunit-color-plain", "158,2,159,47")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/util/sunit.str", "sunit-color-plain", "158,2,159,47")
      ; fail