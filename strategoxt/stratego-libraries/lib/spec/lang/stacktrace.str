module lang/stacktrace

imports
  org.strategoxt.imp.debuggers.stratego.runtime


strategies
  stacktrace-get-all-frame-names =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "stacktrace-get-all-frame-names", "32,2,32,76")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "32,35,32,76")
    ; prim("SSL_stacktrace_get_all_frame_names")
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "stacktrace-get-all-frame-names", "32,2,32,76")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "stacktrace-get-all-frame-names", "32,2,32,76")
      ; fail

  stacktrace-get-current-frame-name =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "stacktrace-get-current-frame-name", "42,2,42,82")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "42,38,42,82")
    ; prim("SSL_stacktrace_get_current_frame_name")
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "stacktrace-get-current-frame-name", "42,2,42,82")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "stacktrace-get-current-frame-name", "42,2,42,82")
      ; fail

  stacktrace-get-current-frame-index =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "stacktrace-get-current-frame-index", "50,2,50,84")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "50,39,50,84")
    ; prim("SSL_stacktrace_get_current_frame_index")
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "stacktrace-get-current-frame-index", "50,2,50,84")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "stacktrace-get-current-frame-index", "50,2,50,84")
      ; fail

  print-stacktrace =
    s-enter(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "print-stacktrace", "52,2,58,4")
    ; s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "53,4,58,4")
    ; where(s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "54,6,57,51")
            ; (s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "54,6,54,47") ; prim("SSL_stacktrace_get_all_frame_names"))
            ; s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "55,6,57,51")
            ; (s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "55,6,55,42")
               ; try(
                   s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "55,10,55,41")
                   ; ?["print_stacktrace_0_0"|<s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "55,38,55,39") ; id>]
                 ))
            ; s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "56,6,57,51")
            ; (s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "56,6,56,12") ; reverse)
            ; s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "57,6,57,51")
            ; list-loop(
                s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "57,16,57,50")
                ; <(s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "57,17,57,24") ; fprintnl)> ( stderr()
                                                                                                                      , [ "\t"
                                                                                                                        , <s-step(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "57,46,57,47") ; id>
                                                                                                                        ]
                                                                                                                      )
              ))
    < s-exit(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "print-stacktrace", "52,2,58,4")
    + s-exit(|"strategoxt/stratego-libraries/lib/spec/lang/stacktrace.str", "print-stacktrace", "52,2,58,4")
      ; fail