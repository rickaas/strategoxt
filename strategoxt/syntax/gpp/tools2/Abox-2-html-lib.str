module Abox-2-html-lib

imports
  org.strategoxt.imp.debuggers.stratego.runtime


imports
  pp-table
  misc


signature
  constructors
    TABLE  : Opts * Rows -> Table
    TR     : Opts * Cels -> TableRpw
    TD     : Opts * Text -> TableData
    TD'    : Text -> Td'
    SPAN   : Opts * Text -> Span
    HREF   : Url * Text -> Href
    ANCHOR : Url -> Anchor
    BR     : Br
    NBSP   : Nbsp
    S      : Text -> Text
    TDTD   : Tdtd
    TDTR   : Text -> Trtd
    PRE    : Text -> Pre
    HR     : Hr


strategies
  html2text =
    s-enter(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "html2text", "31,0,32,26")
    ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "32,3,32,26")
    ; bottomup(
        s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "32,12,32,25")
        ; try(
            s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "32,16,32,24") ; Html2text
          )
      )
    < s-exit(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "html2text", "31,0,32,26")
    + s-exit(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "html2text", "31,0,32,26")
      ; fail

  Html2text =
    s-enter(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "Html2text", "35,0,70,25")
    ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "36,3,70,25")
    ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "36,3,38,24")
       ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "36,3,36,22")
          ; ?TABLE(opts, rows))
       ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "37,6,38,24")
       ; !["<table align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"", opts, ">", rows, "</table>\n"]
       <+ s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "40,6,70,25")
          ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "40,6,41,43")
             ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "40,6,40,23")
                ; ?TR(opts, cells))
             ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "41,6,41,43")
             ; !["<tr ", opts, ">", cells, "</tr>\n"]
             <+ s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "43,6,70,25")
                ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "43,6,44,46")
                   ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "43,6,43,28")
                      ; ?TD(opts, table-data))
                   ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "44,6,44,46")
                   ; !["<td ", opts, ">", table-data, "</td>"]
                   <+ s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "46,6,70,25")
                      ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "46,6,47,29")
                         ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "46,6,46,17")
                            ; ?TD'(text))
                         ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "47,6,47,29")
                         ; !["</td>", text, "<td>"]
                         <+ s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "49,6,70,25")
                            ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "49,6,50,42")
                               ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "49,6,49,24")
                                  ; ?SPAN(opts, text))
                               ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "50,6,50,42")
                               ; !["<span ", opts, ">", text, "</span>"]
                               <+ s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "52,6,70,25")
                                  ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "52,6,53,31")
                                     ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "52,6,52,17")
                                        ; ?PRE(text))
                                     ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "53,6,53,31")
                                     ; !["<pre>", text, "</pre>"]
                                     <+ s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "55,6,70,25")
                                        ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "55,6,56,38")
                                           ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "55,6,55,18")
                                              ; ?TDTR(text))
                                           ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "56,6,56,38")
                                           ; !["</td></tr>", text, "<tr><td>"]
                                           <+ s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "58,6,70,25")
                                              ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "58,6,59,46")
                                                 ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "58,6,58,23")
                                                    ; ?HREF(url, text))
                                                 ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "59,6,59,46")
                                                 ; !["<a href=\"", url, "\">", text, "</a>"]
                                                 <+ s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "61,6,70,25")
                                                    ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "61,6,62,36")
                                                       ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "61,6,61,19")
                                                          ; ?ANCHOR(url))
                                                       ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "62,6,62,36")
                                                       ; !["<a name=\"", url, "\"></a>"]
                                                       <+ s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "64,6,70,25")
                                                          ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "64,6,64,19")
                                                             ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "64,6,64,10")
                                                                ; ?BR())
                                                             ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "64,13,64,19")
                                                             ; !"<br>"
                                                             <+ s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "66,6,70,25")
                                                                ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "66,6,66,23")
                                                                   ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "66,6,66,12")
                                                                      ; ?NBSP())
                                                                   ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "66,15,66,23")
                                                                   ; !"&nbsp;"
                                                                   <+ s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "68,6,70,25")
                                                                      ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "68,6,68,19")
                                                                         ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "68,6,68,10")
                                                                            ; ?HR())
                                                                         ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "68,13,68,19")
                                                                         ; !"<hr>"
                                                                         <+ s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "70,6,70,25")
                                                                            ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "70,6,70,12")
                                                                               ; ?TDTD())
                                                                            ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "70,14,70,25")
                                                                            ; !"</td><td>"))))))))))))
    < s-exit(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "Html2text", "35,0,70,25")
    + s-exit(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "Html2text", "35,0,70,25")
      ; fail

  html-string =
    s-enter(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "html-string", "72,0,82,16")
    ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "73,3,82,16")
    ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "73,3,73,16") ; explode-string)
    ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "74,3,82,16")
    ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "74,3,74,33")
       ; listtd(
           s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "74,11,74,31")
           ; try(
               s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "74,16,74,29") ; replace-quotes
             )
         ))
    ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "75,3,82,16")
    ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "75,3,80,4")
       ; map(
           s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "75,7,80,3")
           ; try(
               s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "76,6,79,36")
               ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "76,6,76,38")
                  ; \ 32 -> <s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "76,14,76,27") ; explode-string> "&nbsp;" \
                  + s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "77,6,79,36")
                    ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "77,6,77,37")
                       ; \ 38 -> <s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "77,14,77,27") ; explode-string> "&amp;" \
                       + s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "78,6,79,36")
                         ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "78,6,78,36")
                            ; \ 60 -> <s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "78,14,78,27") ; explode-string> "&lt;" \
                            + s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "79,6,79,36")
                              ; \ 62 -> <s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "79,14,79,27") ; explode-string> "&gt;" \)))
             )
         ))
    ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "81,3,82,16")
    ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "81,3,81,11") ; flat-list)
    ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "82,3,82,16")
    ; implode-string
    < s-exit(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "html-string", "72,0,82,16")
    + s-exit(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "html-string", "72,0,82,16")
      ; fail

  replace-quotes =
    s-enter(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "replace-quotes", "85,0,87,55")
    ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "86,3,87,55")
    ; (s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "86,3,86,10")
       ; [s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "86,4,86,5") ; 34|s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "86,7,86,9") ; ?xs])
    ; s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "87,3,87,55")
    ; ![96, 96|<s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "87,13,87,50")
                ; oncetd(
                    s-step(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "87,21,87,48")
                    ; \ [34|xs'] -> [39, 39|xs'] \
                  )> xs]
    < s-exit(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "replace-quotes", "85,0,87,55")
    + s-exit(|"strategoxt/syntax/gpp/tools2/Abox-2-html-lib.str", "replace-quotes", "85,0,87,55")
      ; fail