module lib-pp-table-args

imports
  org.strategoxt.imp.debuggers.stratego.runtime


imports
  libstratego-gpp


strategies
  pptable-option =
    s-enter(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "pptable-option", "7,2,11,4")
    ; s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "8,4,11,4")
    ; ArgOption(
        s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "8,14,8,17") ; "-p"
      , s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "9,6,9,42")
        ; where(s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "9,12,9,41")
                ; <(s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "9,13,9,25") ; extend-config)> ( "-p"
                                                                                                                , [<s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "9,37,9,38") ; id>]
                                                                                                                ))
      , s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "10,6,10,55")
        ; !"-p file          Use pretty-print table in file"
      )
    < s-exit(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "pptable-option", "7,2,11,4")
    + s-exit(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "pptable-option", "7,2,11,4")
      ; fail

  get-pptables-config =
    s-enter(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "get-pptables-config", "16,2,17,27")
    ; s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "17,4,17,27")
    ; (s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "17,4,17,20")
       ; <(s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "17,5,17,14") ; get-config)> "-p"
       <+ s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "17,25,17,27")
          ; ![])
    < s-exit(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "get-pptables-config", "16,2,17,27")
    + s-exit(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "get-pptables-config", "16,2,17,27")
      ; fail


strategies
  read-pptables-config =
    s-enter(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "read-pptables-config", "21,2,23,27")
    ; s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "22,4,23,27")
    ; (s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "22,4,22,22") ; get-pptables-config)
    ; s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "23,6,23,27")
    ; map(
        s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "23,10,23,26") ; read-pptable-file
      )
    < s-exit(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "read-pptables-config", "21,2,23,27")
    + s-exit(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "read-pptables-config", "21,2,23,27")
      ; fail

  read-pptable-file =
    s-enter(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "read-pptable-file", "25,2,36,8")
    ; s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "26,6,36,8")
    ; if s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "26,9,26,28")
         ; has-extension(|"af") then
        s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "27,8,27,19") ; ReadFromFile
      else
        s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "29,8,35,10")
        ; if s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "29,11,29,30")
             ; has-extension(|"pp") then
            s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "30,10,31,29")
            ; (s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "30,10,30,34") ; lookup-parsed-pptable-arg
               <+ s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "31,13,31,29") ; parse-pptable-arg)
          else
            s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "33,10,34,19")
            ; (s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "33,10,33,88")
               ; log(
                 | Error()
                 , [ "Pretty-print table must have extension .pp.af or .pp :"
                   , <s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "33,84,33,85") ; id>
                   ]
                 ))
            ; s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "34,12,34,19")
            ; <(s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "34,13,34,16") ; exit)> 1
          end
      end
    < s-exit(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "read-pptable-file", "25,2,36,8")
    + s-exit(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "read-pptable-file", "25,2,36,8")
      ; fail

  lookup-parsed-pptable-arg =
    s-enter(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "lookup-parsed-pptable-arg", "38,2,43,17")
    ; s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "39,6,43,17")
    ; (s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "39,6,39,55")
       ; !( <s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "39,9,39,34")
             ; (s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "39,9,39,21") ; add-extension)
             ; s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "39,24,39,34")
             ; file-exists> ( <s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "39,39,39,40") ; id>
                            , "af"
                            )
          , <s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "39,52,39,53") ; id>
          ))
    ; s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "40,6,43,17")
    ; (s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "40,6,40,55")
       ; where(s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "40,12,40,54")
               ; (s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "40,12,40,49")
                  ; ( s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "40,13,40,29") ; modification-time
                    , s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "40,32,40,48") ; modification-time
                    ))
               ; s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "40,52,40,54")
               ; geq))
    ; s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "41,6,43,17")
    ; (s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "41,6,41,8") ; Fst)
    ; s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "42,6,43,17")
    ; (s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "42,6,42,88")
       ; log(
         | Notice()
         , <s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "42,21,42,34") ; concat-strings> [ "Using existing parsed pretty print-table: "
                                                                                                          , <s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "42,84,42,85") ; id>
                                                                                                          ]
         ))
    ; s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "43,6,43,17")
    ; ReadFromFile
    < s-exit(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "lookup-parsed-pptable-arg", "38,2,43,17")
    + s-exit(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "lookup-parsed-pptable-arg", "38,2,43,17")
      ; fail

  parse-pptable-arg =
    s-enter(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "parse-pptable-arg", "45,2,47,49")
    ; s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "46,4,47,49")
    ; (s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "46,4,46,21") ; parse-pptable-file)
    ; s-step(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "47,6,47,49")
    ; log(|Notice(), "Parsing pretty-print-table")
    < s-exit(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "parse-pptable-arg", "45,2,47,49")
    + s-exit(|"strategoxt/syntax/gpp/tools/lib-pp-table-args.str", "parse-pptable-arg", "45,2,47,49")
      ; fail